<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>P.R.I.S.M. | Реестр Сотрудников</title>
    <style>
        :root { 
            --term-green: #00ff41; 
            --term-dim: #003b00;
            --bg-dark: #050505; 
            --council-gold: #ffd700;
        }

        body { 
            background: var(--bg-dark); 
            color: var(--term-green); 
            font-family: 'Courier New', monospace; 
            margin: 0; 
            text-transform: uppercase;
        }

        /* Эффект монитора */
        body::before {
            content: " "; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%);
            background-size: 100% 3px; pointer-events: none; z-index: 1000;
        }

        nav { border-bottom: 1px solid var(--term-green); padding: 15px; }
        nav a { color: var(--term-green); text-decoration: none; margin-right: 25px; font-size: 0.8em; }

        .container { max-width: 1000px; margin: 40px auto; padding: 20px; }
        
        .header { 
            border: 1px solid var(--council-gold); 
            padding: 15px; 
            color: var(--council-gold); 
            margin-bottom: 30px;
            text-align: center;
            box-shadow: inset 0 0 15px rgba(255, 215, 0, 0.2);
        }

        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { border-bottom: 1px solid var(--term-green); padding: 10px; text-align: left; color: var(--term-dim); font-size: 0.8em; }
        td { padding: 15px 10px; border-bottom: 1px solid rgba(0, 255, 65, 0.1); font-size: 0.9em; }

        .lvl-tag { border: 1px solid var(--term-green); padding: 2px 5px; font-size: 0.8em; }
        .lvl-5 { border-color: var(--council-gold); color: var(--council-gold); }

        .loading-text { text-align: center; animation: blink 1s infinite; }
        @keyframes blink { 0% { opacity: 0; } 50% { opacity: 1; } 100% { opacity: 0; } }

        .btn-back { 
            display: inline-block; margin-top: 20px; color: var(--term-dim); 
            text-decoration: none; font-size: 0.8em; border: 1px solid var(--term-dim); padding: 5px 10px;
        }
        .btn-back:hover { color: var(--term-green); border-color: var(--term-green); }
    </style>
</head>
<body>

<nav>
    <a href="staff.html"><< НАЗАД_В_ТЕРМИНАЛ</a>
</nav>

<div class="container">
    <div class="header">
        <h2 style="margin:0;">ЦЕНТРАЛЬНЫЙ_РЕЕСТР_ПЕРСОНАЛА</h2>
        <div style="font-size: 0.7em;">ДОСТУП: ВЫСШИЙ_СОВЕТ_P.R.I.S.M.</div>
    </div>

    <div id="loading" class="loading-text">ПОЛУЧЕНИЕ_ДАННЫХ_ИЗ_БАЗЫ...</div>
    
    <table id="staffTable" style="display:none;">
        <thead>
            <tr>
                <th>ID</th>
                <th>ИМЯ_СОТРУДНИКА</th>
                <th>ОТДЕЛ</th>
                <th>ДОПУСК</th>
                <th>СТАТУС_ЛОГА</th>
            </tr>
        </thead>
        <tbody id="tableBody">
            </tbody>
    </table>

    <a href="staff.html" class="btn-back">>> ВЕРНУТЬСЯ</a>
</div>

<script>
    const RENDER_API = "https://prism-bot.onrender.com";

    async function loadStaffList() {
        // Проверка уровня доступа (только 5 уровень)
        const level = parseInt(sessionStorage.getItem('prism_level'));
        if (level < 5) {
            document.body.innerHTML = "<h1 style='color:red; text-align:center; margin-top:100px;'>ОТКАЗАНО_В_ДОСТУПЕ: УРОВЕНЬ_5_REQUIRED</h1>";
            setTimeout(() => window.location.href = "staff.html", 2000);
            return;
        }

        try {
            const response = await fetch(`${RENDER_API}/get-staff`);
            const staffData = await response.json();
            
            const tableBody = document.getElementById('tableBody');
            const loading = document.getElementById('loading');
            const table = document.getElementById('staffTable');

            Object.keys(staffData).forEach(id => {
                const user = staffData[id];
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td style="color: var(--term-dim)">#${id}</td>
                    <td style="color: var(--term-green)">${user.name}</td>
                    <td>${user.dept}</td>
                    <td><span class="lvl-tag ${user.level >= 5 ? 'lvl-5' : ''}">L${user.level}</span></td>
                    <td style="font-size: 0.7em; color: #555;">${user.bio.substring(0, 30)}...</td>
                `;
                tableBody.appendChild(row);
            });

            loading.style.display = 'none';
            table.style.display = 'table';

        } catch (e) {
            document.getElementById('loading').innerText = "ОШИБКА_СИНХРОНИЗАЦИИ_БАЗЫ";
        }
    }

    document.addEventListener("DOMContentLoaded", loadStaffList);
</script>

</body>
</html>
