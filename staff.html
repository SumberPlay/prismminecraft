<!DOCTYPE html>
<html lang="ru">
<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <meta charset="UTF-8">
    <title>P.R.I.S.M. | Staff Portal</title>
    <style>
        :root { 
            --neon-green: #00ffcc; 
            --alert-red: #ff4444; 
            --gold: #ffd700;
            --bg-dark: #050505; 
            --panel-bg: #111; 
        }
        body { background: var(--bg-dark); color: #d1d1d1; font-family: 'Courier New', monospace; margin: 0; }
        nav { background: #000; padding: 15px; border-bottom: 1px solid #333; text-align: center; }
        nav a { color: #888; text-decoration: none; text-transform: uppercase; padding: 0 20px; }
        nav a:hover { color: var(--neon-green); }
        .container { max-width: 800px; margin: 50px auto; padding: 0 20px; }
        .card { background: var(--panel-bg); border: 1px solid #222; padding: 30px; margin-bottom: 20px; }
        
        input { 
            background: #000; border: 1px solid #333; color: var(--neon-green); 
            padding: 15px; width: 100%; margin-bottom: 20px; box-sizing: border-box; 
        }

        .btn { 
            background: #1a1a1a; border: 1px solid var(--neon-green); color: var(--neon-green); 
            padding: 15px; width: 100%; cursor: pointer; font-weight: bold; 
            text-transform: uppercase; transition: 0.3s; margin-bottom: 10px;
        }
        .btn:hover { background: var(--neon-green); color: #000; box-shadow: 0 0 10px var(--neon-green); }
        
        .btn-council { border-color: var(--gold); color: var(--gold); }
        .btn-council:hover { background: var(--gold); color: #000; box-shadow: 0 0 15px var(--gold); }

        .role-tag { font-size: 0.8em; color: #666; text-transform: uppercase; letter-spacing: 2px; }
        #staff-content { display: none; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; margin-bottom: 30px; }
        
        textarea {
            width: 100%; height: 100px; background: #000; color: #fff; border: 1px solid #333; 
            padding: 10px; font-family: 'Courier New', monospace; box-sizing: border-box; 
            resize: none; margin-top: 10px; outline: none;
        }
        textarea:focus { border-color: var(--neon-green); }
        #reportStatus { font-size: 0.75em; margin-top: 10px; text-align: center; min-height: 1.2em; }
    </style>
</head>
<body>

<nav>
    <a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a>
    <a href="staff.html">–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º</a>
</nav>

<div class="container">
    <div id="login-zone">
        <h2 style="text-align: center; letter-spacing: 3px;">–ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –¢–ï–†–ú–ò–ù–ê–õ–ê</h2>
        <div class="card">
            <input type="text" id="uid" placeholder="ID –°–û–¢–†–£–î–ù–ò–ö–ê">
            <input type="password" id="ups" placeholder="–ü–ê–†–û–õ–¨">
            <button class="btn" onclick="checkAuth()">–í–•–û–î –í –°–ò–°–¢–ï–ú–£</button>
            <p id="err" style="color: var(--alert-red); display: none; text-align: center; font-weight: bold;">–î–û–°–¢–£–ü –ó–ê–ü–†–ï–©–ï–ù: –ù–ï–í–ï–†–ù–´–ï –î–ê–ù–ù–´–ï</p>
        </div>
    </div>

    <div id="staff-content">
        <div class="role-tag" id="user-role">Access Level: --</div>
        <h2 id="greet" style="margin-top: 5px; color: #fff;">–ó–ê–ì–†–£–ó–ö–ê...</h2>
        <hr style="border: 0; border-bottom: 1px solid #333; margin-bottom: 20px;">

        <div class="grid" id="buttons-container"></div>

        <div class="card" style="border: 1px dashed #444; background: #080808;">
            <h3 style="color: var(--neon-green); margin: 0 0 10px 0; font-size: 1em;">üìù –≠–õ–ï–ö–¢–†–û–ù–ù–´–ô –†–ê–ü–û–†–¢</h3>
            <p style="font-size: 0.7em; color: #666; margin: 0;">–î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –ø–µ—Ä–µ–¥–∞–Ω—ã –≤ —à—Ç–∞–± –º–≥–Ω–æ–≤–µ–Ω–Ω–æ.</p>
            <textarea id="reportText" placeholder="–û–ø–∏—à–∏—Ç–µ —Å–∏—Ç—É–∞—Ü–∏—é –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –æ—Ç—á–µ—Ç..."></textarea>
            <button onclick="sendReport()" class="btn" style="margin-top: 15px; font-size: 0.85em; padding: 12px;">–û–¢–ü–†–ê–í–ò–¢–¨ –í –®–¢–ê–ë</button>
            <div id="reportStatus"></div>
        </div>

        <button onclick="logout()" style="background:none; border:none; color:#444; margin-top:40px; cursor:pointer; width: 100%; font-family: inherit;">[ –ó–ê–í–ï–†–®–ò–¢–¨ –°–ï–ê–ù–° –°–í–Ø–ó–ò ]</button>
    </div>
</div>

<script>
    // --- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ---
    const scriptURL = "–¢–í–û–ô_SCRIPT_URL_–ò–ó_GOOGLE"; // <--- –í–°–¢–ê–í–¨ –°–í–û–Æ –°–°–´–õ–ö–£ –°–Æ–î–ê!

    const staffDB = {
        "M4SK": { pass: "5e03fcd2d70a976a6b026374da5da3f9", role: "scientific", level: 2, name: "–ú—ç–Ω—Å–∏–ö–µ–π–Ω, –ù–ò–î" },
        "KRMP": { pass: "1bf502b835ee007957e558cbb1959ecb", role: "military", level: 3, name: "–ö—Ä–∏–º–ø–∏, –≥–ª–∞–≤–∞ –í–ì–†" },
        "SUMBR": { pass: "8aaa688aadaf78796f5f620a4897eeb3", role: "council", level: 5, name: "–°–∞–º–±–µ—Ä, –í—ã—Å—à–∏–π –°–æ–≤–µ—Ç" },
        "MRYZE": { pass: "b0eee0a274f64e6f5792b85c93321159", role: "council", level: 5, name: "–Æ–∑, –í—ã—Å—à–∏–π –°–æ–≤–µ—Ç" }
    };

    window.onload = function() {
        const savedUID = sessionStorage.getItem('prism_uid');
        if (savedUID && staffDB[savedUID]) {
            renderDashboard(staffDB[savedUID]);
        }
    };

    function checkAuth() {
        const id = document.getElementById('uid').value.toUpperCase().trim();
        const ps = document.getElementById('ups').value;
        const user = staffDB[id];

        if (user) {
            const hashedInput = CryptoJS.MD5(ps).toString();
            if (user.pass === hashedInput) {
                sessionStorage.setItem('prism_uid', id); 
                renderDashboard(user);
            } else { showError(); }
        } else { showError(); }
    }

    function showError() {
        document.getElementById('err').style.display = 'block';
        setTimeout(() => { document.getElementById('err').style.display = 'none'; }, 3000);
    }

    function renderDashboard(user) {
        document.getElementById('login-zone').style.display = 'none';
        document.getElementById('staff-content').style.display = 'block';
        document.getElementById('greet').innerText = user.name;
        document.getElementById('user-role').innerText = "Access Level: " + user.role.toUpperCase();
        
        const container = document.getElementById('buttons-container');
        container.innerHTML = ""; 

        // –ö–Ω–æ–ø–∫–∞ –¥–æ—Å—å–µ (–¥–ª—è –≤—Å–µ—Ö)
        container.innerHTML += '<button class="btn" onclick="location.href=\'profile.html\'">üë§ –õ–ò–ß–ù–û–ï –î–û–°–¨–ï</button>';

        if (user.role === "scientific") {
            container.innerHTML += '<button class="btn" onclick="nav(\'archive\')">üìÇ –ê–†–•–ò–í –ê–ù–û–ú–ê–õ–ò–ô</button>';
            container.innerHTML += '<button class="btn" onclick="nav(\'map\')">üó∫Ô∏è –ö–ê–†–¢–ê –ö–û–ú–ü–õ–ï–ö–°–û–í</button>';
            container.innerHTML += '<button class="btn" onclick="nav(\'nid\')">üß™ –ü–†–û–¢–û–ö–û–õ–´ –ù–ò–î</button>';
        } 
        else if (user.role === "military") {
            container.innerHTML += '<button class="btn" onclick="nav(\'military_prot\')">üõ°Ô∏è –í–û–ï–ù–ù–´–ï –ü–†–û–¢–û–ö–û–õ–´</button>';
            container.innerHTML += '<button class="btn" onclick="nav(\'map\')">üó∫Ô∏è –ö–ê–†–¢–ê –ö–û–ú–ü–õ–ï–ö–°–û–í</button>';
        } 
        else if (user.role === "council") {
            container.innerHTML += '<button class="btn btn-council" onclick="nav(\'archive\')">üìÇ –í–ï–°–¨ –ê–†–•–ò–í</button>';
            container.innerHTML += '<button class="btn btn-council" onclick="nav(\'map\')">üó∫Ô∏è –í–°–ï –ö–û–ú–ü–õ–ï–ö–°–´</button>';
            container.innerHTML += '<button class="btn btn-council" onclick="nav(\'nid\')">üß™ –ù–ò–î (–ß–¢–ï–ù–ò–ï)</button>';
            container.innerHTML += '<button class="btn btn-council" onclick="nav(\'military_prot\')">üõ°Ô∏è –û–ë–û–†–û–ù–ê (–ß–¢–ï–ù–ò–ï)</button>';
            container.innerHTML += '<button class="btn btn-council" style="grid-column: span 2;" onclick="nav(\'override\')">‚öñÔ∏è –ü–†–û–¢–û–ö–û–õ –û–ë–ù–£–õ–ï–ù–ò–Ø</button>';
        }
    }

    async function sendReport() {
        const text = document.getElementById('reportText').value.trim();
        const uid = sessionStorage.getItem('prism_uid') || "Unknown";
        const statusMsg = document.getElementById('reportStatus');

        if (!text) {
            statusMsg.innerText = "‚ùå –û–®–ò–ë–ö–ê: –¢–ï–ö–°–¢ –û–¢–°–£–¢–°–¢–í–£–ï–¢";
            statusMsg.style.color = "var(--alert-red)";
            return;
        }

        statusMsg.innerText = "‚ö° –û–¢–ü–†–ê–í–ö–ê –î–ê–ù–ù–´–•...";
        statusMsg.style.color = "#888";

        try {
            // –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Google Script
            await fetch(`${scriptURL}?action=report&uid=${uid}&text=${encodeURIComponent(text)}`, { mode: 'no-cors' });
            
            statusMsg.style.color = "var(--neon-green)";
            statusMsg.innerText = "‚úÖ –†–ê–ü–û–†–¢ –ü–†–ò–ù–Ø–¢ –®–¢–ê–ë–û–ú";
            document.getElementById('reportText').value = "";
        } catch (e) {
            statusMsg.style.color = "var(--alert-red)";
            statusMsg.innerText = "‚ö†Ô∏è –°–ë–û–ô –°–ï–¢–ò. –ü–û–í–¢–û–†–ò–¢–ï –ü–û–ü–´–¢–ö–£";
        }
    }

    function logout() {
        sessionStorage.clear();
        location.reload(); 
    }

    function nav(page) {
        location.href = page + ".html";
    }
</script>
</body>
</html>
