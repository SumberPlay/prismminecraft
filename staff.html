<!DOCTYPE html>
<html lang="ru">
<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <meta charset="UTF-8">
    <title>P.R.I.S.M. | Staff Portal</title>
    <style>
        :root { 
            --neon-green: #00ffcc; 
            --alert-red: #ff4444; 
            --gold: #ffd700;
            --bg-dark: #050505; 
            --panel-bg: #111; 
        }
        body { background: var(--bg-dark); color: #d1d1d1; font-family: 'Courier New', monospace; margin: 0; }
        nav { background: #000; padding: 15px; border-bottom: 1px solid #333; text-align: center; }
        nav a { color: #888; text-decoration: none; text-transform: uppercase; padding: 0 20px; }
        nav a:hover { color: var(--neon-green); }
        .container { max-width: 800px; margin: 50px auto; padding: 0 20px; }
        .card { background: var(--panel-bg); border: 1px solid #222; padding: 30px; }
        
        input { 
            background: #000; border: 1px solid #333; color: var(--neon-green); 
            padding: 15px; width: 100%; margin-bottom: 20px; box-sizing: border-box; 
        }

        .btn { 
            background: #1a1a1a; border: 1px solid var(--neon-green); color: var(--neon-green); 
            padding: 15px; width: 100%; cursor: pointer; font-weight: bold; 
            text-transform: uppercase; transition: 0.3s; margin-bottom: 10px;
        }
        .btn:hover { background: var(--neon-green); color: #000; box-shadow: 0 0 10px var(--neon-green); }
        
        /* –û—Å–æ–±—ã–π —Å—Ç–∏–ª—å –¥–ª—è –í—ã—Å—à–µ–≥–æ –°–æ–≤–µ—Ç–∞ */
        .btn-council { border-color: var(--gold); color: var(--gold); }
        .btn-council:hover { background: var(--gold); color: #000; box-shadow: 0 0 15px var(--gold); }

        .role-tag { font-size: 0.8em; color: #666; text-transform: uppercase; letter-spacing: 2px; }
        #staff-content { display: none; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
    </style>
</head>
<body>

<nav>
    <a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a>
    <a href="staff.html">–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º</a>
</nav>

<div class="container">
    <div id="login-zone">
        <h2 style="text-align: center;">–ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –¢–ï–†–ú–ò–ù–ê–õ–ê</h2>
        <div class="card">
            <input type="text" id="uid" placeholder="ID –°–û–¢–†–£–î–ù–ò–ö–ê">
            <input type="password" id="ups" placeholder="–ü–ê–†–û–õ–¨">
            <button class="btn" onclick="checkAuth()">–í–•–û–î</button>
            <p id="err" style="color: var(--alert-red); display: none; text-align: center;">–û–®–ò–ë–ö–ê: –î–û–°–¢–£–ü –ó–ê–ü–†–ï–©–ï–ù</p>
        </div>
    </div>

    <div id="staff-content">
        <div class="role-tag" id="user-role">Role: Undefined</div>
        <h2 id="greet" style="margin-top: 5px;">–ü–ê–ù–ï–õ–¨ –£–ü–†–ê–í–õ–ï–ù–ò–Ø</h2>
        <hr border="0" style="border-bottom: 1px solid #222; margin-bottom: 20px;">

        <div class="grid" id="buttons-container">
            </div>

        <button onclick="logout()" style="background:none; border:none; color:#444; margin-top:40px; cursor:pointer; width: 100%;">[–ó–ê–í–ï–†–®–ò–¢–¨ –°–ï–ê–ù–°]</button>
    </div>
</div>

<script>
    const RENDER_URL = "https://prism-bot.onrender.com";

    // --- –ü–†–û–í–ï–†–ö–ê –°–ï–°–°–ò–ò –ü–†–ò –ó–ê–ì–†–£–ó–ö–ï ---
    window.onload = function() {
        const savedUser = sessionStorage.getItem('prism_user_data');
        if (savedUser) {
            renderDashboard(JSON.parse(savedUser));
        }
    };

    async function checkAuth() {
        const uid = document.getElementById('uid').value;
        const ups = document.getElementById('ups').value;
        
        if (!uid || !ups) return showError();

        const passwordMD5 = CryptoJS.MD5(ups).toString();

        try {
            const res = await fetch(`${RENDER_URL}/api/login`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ uid, passwordMD5 })
            });
            const data = await res.json();

            if (data.success) {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–≤–∫–ª—é—á–∞—è —Ä–æ–ª—å –∏ —É—Ä–æ–≤–µ–Ω—å) –≤ —Å–µ—Å—Å–∏—é
                sessionStorage.setItem('prism_uid', uid.toUpperCase());
                sessionStorage.setItem('prism_user_data', JSON.stringify(data));
                renderDashboard(data);
            } else {
                showError();
            }
        } catch (e) {
            console.error("Connection error:", e);
            showError();
        }
    }

    function showError() {
        document.getElementById('err').style.display = 'block';
        setTimeout(() => { document.getElementById('err').style.display = 'none'; }, 3000);
    }

    function renderDashboard(user) {
        document.getElementById('login-zone').style.display = 'none';
        document.getElementById('staff-content').style.display = 'block';
        document.getElementById('greet').innerText = user.name;
        document.getElementById('user-role').innerText = "–î–æ–ø—É—Å–∫: " + user.role;
        const container = document.getElementById('buttons-container');
        container.innerHTML = ""; 

        const role = user.role;

        // –¢–≤–æ—è –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–Ω–æ–ø–æ–∫
        if (role === "scientific") {
            container.innerHTML += '<button class="btn" onclick="location.href=\'profile.html\'">üë§ –õ–ò–ß–ù–û–ï –î–û–°–¨–ï</button>';
            container.innerHTML += '<button class="btn" onclick="nav(\'archive\')">üìÇ –ê–†–•–ò–í –ê–ù–û–ú–ê–õ–ò–ô</button>';
            container.innerHTML += '<button class="btn" onclick="nav(\'map\')">üó∫Ô∏è –ö–ê–†–¢–ê –ö–û–ú–ü–õ–ï–ö–°–û–í</button>';
            container.innerHTML += '<button class="btn" onclick="nav(\'nid\')">üß™ –ü–†–û–¢–û–ö–û–õ–´ –ù–ò–î</button>';
        } 
        else if (role === "military") {
            container.innerHTML += '<button class="btn" onclick="location.href=\'profile.html\'">üë§ –õ–ò–ß–ù–û–ï –î–û–°–¨–ï</button>';
            container.innerHTML += '<button class="btn" onclick="nav(\'military_prot\')">üõ°Ô∏è –í–û–ï–ù–ù–´–ï –ü–†–û–¢–û–ö–û–õ–´</button>';
            container.innerHTML += '<button class="btn" onclick="nav(\'map\')">üó∫Ô∏è –ö–ê–†–¢–ê –ö–û–ú–ü–õ–ï–ö–°–û–í</button>';
        } 
        else if (role === "council") {
            container.innerHTML += '<button class="btn" onclick="location.href=\'profile.html\'">üë§ –õ–ò–ß–ù–û–ï –î–û–°–¨–ï</button>';
            container.innerHTML += '<button class="btn btn-council" onclick="nav(\'archive\')">üìÇ –í–ï–°–¨ –ê–†–•–ò–í</button>';
            container.innerHTML += '<button class="btn btn-council" onclick="nav(\'map\')">üó∫Ô∏è –í–°–ï –ö–û–ú–ü–õ–ï–ö–°–´</button>';
            container.innerHTML += '<button class="btn btn-council" onclick="nav(\'nid\')">üß™ –ù–ò–î (–ß–¢–ï–ù–ò–ï)</button>';
            container.innerHTML += '<button class="btn btn-council" onclick="nav(\'military_prot\')">üõ°Ô∏è –û–ë–û–†–û–ù–ê (–ß–¢–ï–ù–ò–ï)</button>';
            container.innerHTML += '<button class="btn btn-council" style="grid-column: span 2;" onclick="nav(\'override\')">‚öñÔ∏è –ü–†–û–¢–û–ö–û–õ –û–ë–ù–£–õ–ï–ù–ò–Ø</button>';
        }
    }

    function logout() {
        sessionStorage.clear();
        location.reload(); 
    }

    function nav(page) {
        location.href = page + ".html";
    }
</script>

</body>
</html>
