<!DOCTYPE html>
<html lang="ru">
<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <meta charset="UTF-8">
    <title>P.R.I.S.M. | Staff Portal</title>
    <style>
        :root { 
            --neon-green: #00ffcc; 
            --alert-red: #ff4444; 
            --gold: #ffd700;
            --bg-dark: #050505; 
            --panel-bg: #111; 
        }
        body { 
            background: var(--bg-dark); 
            color: #d1d1d1; 
            font-family: 'Courier New', monospace; 
            margin: 0; 
            transition: background 0.5s;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç—Ä–µ–≤–æ–≥–∏ */
        body.alarm-mode { background: #1a0505; }
        body.alarm-mode .card { border-color: var(--alert-red); box-shadow: 0 0 15px rgba(255, 68, 68, 0.1); }

        nav { background: #000; padding: 15px; border-bottom: 1px solid #333; text-align: center; }
        nav a { color: #888; text-decoration: none; text-transform: uppercase; padding: 0 20px; font-size: 0.9em; }
        nav a:hover { color: var(--neon-green); }

        .container { max-width: 800px; margin: 50px auto; padding: 0 20px; }
        .card { background: var(--panel-bg); border: 1px solid #222; padding: 30px; margin-bottom: 20px; position: relative; }
        
        #system-status-indicator {
            text-align: center; font-size: 0.8em; margin-bottom: 20px; letter-spacing: 2px; font-weight: bold;
        }

        input { 
            background: #000; border: 1px solid #333; color: var(--neon-green); 
            padding: 15px; width: 100%; margin-bottom: 20px; box-sizing: border-box; outline: none;
        }
        input:focus { border-color: var(--neon-green); }

        .btn { 
            background: #1a1a1a; border: 1px solid var(--neon-green); color: var(--neon-green); 
            padding: 15px; width: 100%; cursor: pointer; font-weight: bold; 
            text-transform: uppercase; transition: 0.3s; margin-bottom: 10px;
        }
        .btn:hover { background: var(--neon-green); color: #000; box-shadow: 0 0 10px var(--neon-green); }
        
        .btn-council { border-color: var(--gold); color: var(--gold); }
        .btn-council:hover { background: var(--gold); color: #000; box-shadow: 0 0 15px var(--gold); }

        .role-tag { font-size: 0.8em; color: #666; text-transform: uppercase; letter-spacing: 2px; }
        #staff-content { display: none; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; margin-bottom: 30px; }
        
        textarea {
            width: 100%; height: 100px; background: #000; color: #fff; border: 1px solid #333; 
            padding: 10px; font-family: 'Courier New', monospace; box-sizing: border-box; 
            resize: none; margin-top: 10px; outline: none;
        }
        textarea:focus { border-color: var(--neon-green); }
        #reportStatus { font-size: 0.75em; margin-top: 10px; text-align: center; min-height: 1.2em; }
    </style>
</head>
<body>

<nav>
    <a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a>
    <a href="archive.html">–ê—Ä—Ö–∏–≤</a>
</nav>

<div class="container">
    <div id="system-status-indicator">–°–í–Ø–ó–¨ –° –¶–ï–ù–¢–†–û–ú: <span id="sync-val">...</span></div>

    <div id="login-zone">
        <h2 style="text-align: center; letter-spacing: 3px;">–ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –¢–ï–†–ú–ò–ù–ê–õ–ê</h2>
        <div class="card">
            <input type="text" id="uid" placeholder="ID –°–û–¢–†–£–î–ù–ò–ö–ê">
            <input type="password" id="ups" placeholder="–ü–ê–†–û–õ–¨">
            <button class="btn" onclick="checkAuth()">–í–•–û–î –í –°–ò–°–¢–ï–ú–£</button>
            <p id="err" style="color: var(--alert-red); display: none; text-align: center; font-weight: bold;">–î–û–°–¢–£–ü –ó–ê–ü–†–ï–©–ï–ù: –ù–ï–í–ï–†–ù–´–ï –î–ê–ù–ù–´–ï</p>
        </div>
    </div>

    <div id="staff-content">
        <div class="role-tag" id="user-role">Access Level: --</div>
        <h2 id="greet" style="margin-top: 5px; color: #fff;">–ó–ê–ì–†–£–ó–ö–ê...</h2>
        <hr style="border: 0; border-bottom: 1px solid #333; margin-bottom: 20px;">

        <div class="grid" id="buttons-container"></div>
        <div id="incident-box" style="display: none; border: 1px solid #ff4444; background: rgba(255, 68, 68, 0.1); padding: 15px; margin: 20px 0; color: #ff4444;">
            <span style="font-size: 0.8em; opacity: 0.7;">[!] –ü–†–ò–ß–ò–ù–ê –¢–†–ï–í–û–ì–ò:</span>
            <div id="incident-reason" style="font-weight: bold; font-size: 1.2em; margin-top: 5px;"></div>
        </div>
        <div class="card" style="border: 1px dashed #444; background: #080808;">
            <h3 style="color: var(--neon-green); margin: 0 0 10px 0; font-size: 1em;">üìù –≠–õ–ï–ö–¢–†–û–ù–ù–´–ô –†–ê–ü–û–†–¢</h3>
            <p style="font-size: 0.7em; color: #666; margin: 0;">–î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –ø–µ—Ä–µ–¥–∞–Ω—ã –≤ —à—Ç–∞–± –º–≥–Ω–æ–≤–µ–Ω–Ω–æ —á–µ—Ä–µ–∑ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–∞–Ω–∞–ª.</p>
            <textarea id="reportText" placeholder="–û–ø–∏—à–∏—Ç–µ —Å–∏—Ç—É–∞—Ü–∏—é –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –æ—Ç—á–µ—Ç..."></textarea>
            <button onclick="sendReport()" class="btn" style="margin-top: 15px; font-size: 0.85em; padding: 12px;">–û–¢–ü–†–ê–í–ò–¢–¨ –í –®–¢–ê–ë</button>
            <div id="reportStatus"></div>
        </div>

        <button onclick="logout()" style="background:none; border:none; color:#444; margin-top:40px; cursor:pointer; width: 100%; font-family: inherit;">[ –ó–ê–í–ï–†–®–ò–¢–¨ –°–ï–ê–ù–° –°–í–Ø–ó–ò ]</button>
    </div>
</div>

<script>
// --- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –°–ï–†–í–ï–†–ê (RENDER) ---
const RENDER_API = "https://prism-bot.onrender.com"; // <--- –ó–ê–ú–ï–ù–ò –ù–ê –°–í–û–Æ –°–°–´–õ–ö–£!

const staffDB = {
    "M4SK": { pass: "5e03fcd2d70a976a6b026374da5da3f9", role: "scientific", level: 3, name: "–ú—ç–Ω—Å–∏–ö–µ–π–Ω, –ù–ò–î" },
    "KRMP": { pass: "1bf502b835ee007957e558cbb1959ecb", role: "military", level: 2, name: "–ö—Ä–∏–º–ø–∏, –≥–ª–∞–≤–∞ –í–ì–†" },
    "SUMBR": { pass: "8aaa688aadaf78796f5f620a4897eeb3", role: "council", level: 5, name: "–°–∞–º–±–µ—Ä, –í—ã—Å—à–∏–π –°–æ–≤–µ—Ç" },
    "MRYZE": { pass: "b0eee0a274f64e6f5792b85c93321159", role: "council", level: 5, name: "–Æ–∑, –í—ã—Å—à–∏–π –°–æ–≤–µ—Ç" }
};

// --- –§–£–ù–ö–¶–ò–Ø –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–ò –° –ë–û–¢–û–ú ---
<script>
const RENDER_API = "https://prism-bot.onrender.com";

async function syncSystem() {
    try {
        const response = await fetch(`${RENDER_API}/status`);
        const data = await response.json();
        
        // 1. –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç —Å—Ç–∞—Ç—É—Å–∞
        const syncVal = document.getElementById('sync-val');
        syncVal.innerText = data.label;
        syncVal.style.color = data.color;

        // 2. –õ–æ–≥–∏–∫–∞ –¥–ª—è –ø—Ä–∏—á–∏–Ω—ã —Ç—Ä–µ–≤–æ–≥–∏
        const incidentBox = document.getElementById('incident-box');
        const incidentReason = document.getElementById('incident-reason');

        if (data.state === "RED") {
            document.body.classList.add('alarm-mode');
            
            // –ï—Å–ª–∏ –≤ –±–æ—Ç–µ –≤–≤–µ–ª–∏ –ø—Ä–∏—á–∏–Ω—É ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ—ë
            if (data.reason) {
                incidentBox.style.display = "block";
                incidentReason.innerText = data.reason.toUpperCase();
            }
        } else {
            document.body.classList.remove('alarm-mode');
            incidentBox.style.display = "none";
        }

    } catch (e) {
        const syncVal = document.getElementById('sync-val');
        if (syncVal) {
            syncVal.innerText = "OFFLINE";
            syncVal.style.color = "gray";
        }
        console.error("–û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:", e);
    }
}

// –ó–∞–ø—É—Å–∫–∞–µ–º —Ü–∏–∫–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã)
setInterval(syncSystem, 3000);
syncSystem(); // –ò –æ–¥–∏–Ω —Ä–∞–∑ —Å—Ä–∞–∑—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
</script>

setInterval(syncSystem, 3000); // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫
syncSystem();

window.onload = function() {
    const savedUID = sessionStorage.getItem('prism_uid');
    if (savedUID && staffDB[savedUID]) {
        renderDashboard(staffDB[savedUID]);
    }
};

function checkAuth() {
    const id = document.getElementById('uid').value.toUpperCase().trim();
    const ps = document.getElementById('ups').value;
    const user = staffDB[id];

    if (user) {
        const hashedInput = CryptoJS.MD5(ps).toString();
        if (user.pass === hashedInput) {
            sessionStorage.setItem('prism_uid', id); 
            localStorage.setItem('prism_level', user.level);
            renderDashboard(user);
        } else { showError(); }
    } else { showError(); }
}

function showError() {
    document.getElementById('err').style.display = 'block';
    setTimeout(() => { document.getElementById('err').style.display = 'none'; }, 3000);
}

function renderDashboard(user) {
    document.getElementById('login-zone').style.display = 'none';
    document.getElementById('staff-content').style.display = 'block';
    document.getElementById('greet').innerText = user.name;
    document.getElementById('user-role').innerText = "Access Level: " + user.role.toUpperCase() + " (Lvl " + user.level + ")";
    
    const container = document.getElementById('buttons-container');
    container.innerHTML = ""; 

    container.innerHTML += '<button class="btn" onclick="location.href=\'profile.html\'">üë§ –õ–ò–ß–ù–û–ï –î–û–°–¨–ï</button>';

    if (user.role === "scientific") {
        container.innerHTML += '<button class="btn" onclick="nav(\'archive\')">üìÇ –ê–†–•–ò–í –ê–ù–û–ú–ê–õ–ò–ô</button>';
        container.innerHTML += '<button class="btn" onclick="nav(\'map\')">üó∫Ô∏è –ö–ê–†–¢–ê –ö–û–ú–ü–õ–ï–ö–°–û–í</button>';
    } 
    else if (user.role === "military") {
        container.innerHTML += '<button class="btn" onclick="nav(\'military_prot\')">üõ°Ô∏è –í–û–ï–ù–ù–´–ï –ü–†–û–¢–û–ö–û–õ–´</button>';
        container.innerHTML += '<button class="btn" onclick="nav(\'map\')">üó∫Ô∏è –ö–ê–†–¢–ê –ö–û–ú–ü–õ–ï–ö–°–û–í</button>';
    } 
    else if (user.role === "council") {
        container.innerHTML += '<button class="btn btn-council" onclick="nav(\'archive\')">üìÇ –í–ï–°–¨ –ê–†–•–ò–í</button>';
        container.innerHTML += '<button class="btn btn-council" onclick="nav(\'map\')">üó∫Ô∏è –í–°–ï –ö–û–ú–ü–õ–ï–ö–°–´</button>';
        container.innerHTML += '<button class="btn btn-council" style="grid-column: span 2;" onclick="nav(\'override\')">‚öñÔ∏è –ü–†–û–¢–û–ö–û–õ –û–ë–ù–£–õ–ï–ù–ò–Ø</button>';
    }
}

// --- –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø –û–¢–ü–†–ê–í–ö–ò –†–ê–ü–û–†–¢–ê –ù–ê RENDER ---
async function sendReport() {
    const text = document.getElementById('reportText').value.trim();
    const uid = sessionStorage.getItem('prism_uid') || "Unknown";
    const statusMsg = document.getElementById('reportStatus');

    if (!text) {
        statusMsg.innerText = "‚ùå –û–®–ò–ë–ö–ê: –ü–£–°–¢–û–ô –¢–ï–ö–°–¢";
        statusMsg.style.color = "var(--alert-red)";
        return;
    }

    statusMsg.innerText = "‚ö° –®–ò–§–†–û–í–ê–ù–ò–ï –ò –û–¢–ü–†–ê–í–ö–ê...";
    statusMsg.style.color = "#888";

    try {
        const response = await fetch(`${RENDER_API}/report`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ uid: uid, text: text })
        });

        if (response.ok) {
            statusMsg.style.color = "var(--neon-green)";
            statusMsg.innerText = "‚úÖ –†–ê–ü–û–†–¢ –î–û–°–¢–ê–í–õ–ï–ù –í –®–¢–ê–ë (TELEGRAM)";
            document.getElementById('reportText').value = "";
        } else {
            throw new Error();
        }
    } catch (e) {
        statusMsg.style.color = "var(--alert-red)";
        statusMsg.innerText = "‚ö†Ô∏è –ö–ê–ù–ê–õ –°–í–Ø–ó–ò –ü–†–ï–†–í–ê–ù (–°–ï–†–í–ï–† OFFLINE)";
    }
}

function logout() {
    sessionStorage.clear();
    localStorage.removeItem('prism_level');
    location.reload(); 
}

function nav(page) {
    location.href = page + ".html";
}
</script>
</body>
</html>


