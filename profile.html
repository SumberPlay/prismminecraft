<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>P.R.I.S.M. | DATA_DOSSIER</title>
    <style>
        :root { 
            --term-green: #00ff41; 
            --term-dim: #003b00;
            --alert-red: #ff0000; 
            --gold: #ffd700;
            --bg-dark: #050505; 
        }

        /* Убираем прокрутку и фиксируем боксы */
        * { box-sizing: border-box; }

        body { 
            background: var(--bg-dark); 
            color: var(--term-green); 
            font-family: 'Courier New', monospace; 
            margin: 0; 
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            text-transform: uppercase;
            overflow-x: hidden; /* Запрет горизонтальной прокрутки */
        }

        /* Эффект ЭЛТ-монитора */
        body::before {
            content: " ";
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%), 
                        linear-gradient(90deg, rgba(0, 255, 0, 0.02), rgba(0, 255, 0, 0.01), rgba(0, 0, 255, 0.02));
            background-size: 100% 3px, 3px 100%;
            pointer-events: none; z-index: 1000;
        }

        /* Шапка страницы */
        nav { width: 100%; border-bottom: 1px solid var(--term-dim); padding: 15px; background: #000; z-index: 10; }
        nav a { color: var(--term-green); text-decoration: none; font-size: 0.8em; opacity: 0.7; }
        nav a:hover { opacity: 1; text-shadow: 0 0 8px var(--term-green); }

        .container { max-width: 800px; width: 95%; margin: 40px auto; position: relative; }

        /* Карточка досье */
        .dossier-card {
            border: 1px solid var(--term-dim);
            background: rgba(0, 10, 0, 0.8);
            padding: 30px;
            position: relative;
            box-shadow: inset 0 0 20px #000;
        }

        .dossier-card::before {
            content: "АРХИВНЫЙ_ФАЙЛ_ЛИЧНОГО_ДЕЛА";
            position: absolute; top: -10px; left: 20px;
            background: var(--bg-dark); padding: 0 10px;
            font-size: 0.7em; color: var(--term-dim);
        }

        .header-section {
            display: flex;
            gap: 30px;
            border-bottom: 1px solid var(--term-dim);
            padding-bottom: 25px;
            margin-bottom: 25px;
            flex-wrap: wrap; /* Для мобильных устройств */
        }

        .photo-frame {
            width: 150px; height: 150px;
            border: 1px solid var(--term-green);
            background: #000;
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
        }

        .photo-frame img { width: 100%; height: 100%; object-fit: cover; filter: sepia(1) hue-rotate(90deg) brightness(1.2); }

        .scan-line {
            position: absolute; width: 100%; height: 2px;
            background: var(--term-green);
            box-shadow: 0 0 10px var(--term-green);
            animation: scan 3s infinite linear;
        }
        @keyframes scan { 0% { top: 0; } 100% { top: 100%; } }

        /* Инфо-сетка */
        .info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
        .info-item { border-left: 1px solid var(--term-dim); padding-left: 15px; }
        .label { font-size: 0.65em; color: var(--term-dim); display: block; margin-bottom: 5px; }
        .value { font-size: 1em; letter-spacing: 1px; }

        /* Секции заметок и задач */
        .sub-section {
            margin-top: 25px;
            border: 1px solid var(--term-dim);
            padding: 15px;
            background: rgba(0, 5, 0, 0.5);
        }
        .sub-title { font-size: 0.75em; margin-bottom: 10px; color: var(--term-green); border-bottom: 1px solid var(--term-dim); padding-bottom: 5px; }
        .sub-content { font-size: 0.85em; color: #888; line-height: 1.6; }

        /* Совет (L5) */
        .council-mode { border-color: var(--gold) !important; }
        .council-text { color: var(--gold) !important; text-shadow: 0 0 5px var(--gold); }

        #sync-status { position: fixed; bottom: 10px; right: 20px; font-size: 0.6em; opacity: 0.4; pointer-events: none; }
    </style>
</head>
<body>

<nav>
    <a href="staff.html">< КОРНЕВОЙ_КАТАЛОГ</a>
</nav>

<div class="container">
    <div class="dossier-card" id="card">
        <div class="header-section">
            <div class="photo-frame">
                <div class="scan-line"></div>
                <img id="u-photo" src="" alt="NO_DATA">
            </div>
            <div>
                <h1 id="u-name" style="margin: 0; font-size: 1.5em;">ЗАГРУЗКА...</h1>
                <p id="u-id" style="color: var(--term-dim); margin: 5px 0;">ID: ---</p>
                <div id="u-status" style="border: 1px solid var(--term-green); display: inline-block; padding: 2px 8px; font-size: 0.6em; margin-top: 10px;">СТАТУС: АКТИВЕН</div>
            </div>
        </div>

        <div class="info-grid">
            <div class="info-item">
                <span class="label">ОТДЕЛ_НАЗНАЧЕНИЯ</span>
                <span class="value" id="u-dept">---</span>
            </div>
            <div class="info-item">
                <span class="label">УРОВЕНЬ_ДОПУСКА</span>
                <span class="value" id="u-level">---</span>
            </div>
            <div class="info-item">
                <span class="label">СПЕЦИАЛИЗАЦИЯ</span>
                <span class="value" id="u-spec">---</span>
            </div>
            <div class="info-item">
                <span class="label">ДАТА_РЕГИСТРАЦИИ</span>
                <span class="value" id="u-joined">---</span>
            </div>
        </div>

        <div class="sub-section">
            <div class="sub-title">ТЕКУЩИЕ_ДИРЕКТИВЫ</div>
            <div class="sub-content" id="u-tasks">ОЖИДАНИЕ ОБНОВЛЕНИЯ ОТ СЕРВЕРА...</div>
        </div>

        <div class="sub-section" id="note-sec" style="display:none;">
            <div class="sub-title">ОСОБЫЕ_ОТМЕТКИ_БЕЗОПАСНОСТИ</div>
            <div class="sub-content" id="u-note" style="font-style: italic;">---</div>
        </div>
    </div>
</div>

<div id="sync-status">СВЯЗЬ_С_БАЗОЙ: <span id="sync-val">...</span></div>

<script>
    const RENDER_API = "https://prism-bot.onrender.com";

    async function loadData() {
        // Получаем ID текущего пользователя из памяти браузера
        const session = JSON.parse(localStorage.getItem('prism_user'));
        if (!session) { window.location.href = "staff.html"; return; }

        try {
            // Запрашиваем список всех сотрудников
            const res = await fetch(`${RENDER_API}/get-admin-staff`);
            const db = await res.json();
            
            // Ищем нашего пользователя в массиве по ID
            const user = db.find(u => u.id === session.id);

            if (!user) {
                document.getElementById('u-name').innerText = "ОШИБКА: ID НЕ НАЙДЕН";
                return;
            }

            // Заполняем поля
            document.getElementById('u-name').innerText = user.name;
            document.getElementById('u-id').innerText = "ID_TOKEN: " + session.id;
            document.getElementById('u-dept').innerText = user.dept || "ОБЩИЙ ОТДЕЛ";
            document.getElementById('u-level').innerText = "CLEARANCE_L" + user.level;
            document.getElementById('u-spec').innerText = user.spec || "НЕ НАЗНАЧЕНА";
            document.getElementById('u-joined').innerText = user.created_at ? new Date(user.created_at).toLocaleDateString() : "НЕИЗВЕСТНО";

            // Фото (используем MC Name или заглушку)
            const skinName = user.mc_name || 'MHF_Question';
            document.getElementById('u-photo').src = `https://minotar.net/armor/bust/${skinName}/150.png`;

            // Задачи (Проверяем, есть ли они вообще)
            if (user.tasks && Array.isArray(user.tasks) && user.tasks.length > 0) {
                document.getElementById('u-tasks').innerHTML = user.tasks
                    .map(t => `<div>${t.done ? '[X]' : '[ ]'} ${t.text}</div>`).join('');
            } else {
                document.getElementById('u-tasks').innerText = "> АКТИВНЫХ ДИРЕКТИВ НЕ ОБНАРУЖЕНО";
            }

            // Секретные заметки (видны только с 3 уровня)
            if (session.level >= 3) {
                document.getElementById('note-sec').style.display = 'block';
                document.getElementById('u-note').innerText = user.note || "ЗАПИСИ ОТСУТСТВУЮТ";
            }

            // Режим Совета (Золотой стиль для L5)
            if (user.level >= 5) {
                document.getElementById('card').classList.add('council-mode');
                document.getElementById('u-name').classList.add('council-text');
                // Добавляем золотой класс всем значениям
                const values = document.querySelectorAll('.value');
                values.forEach(v => v.classList.add('council-text'));
            }

        } catch (e) {
            console.error(e);
            document.getElementById('u-name').innerText = "ОШИБКА_СВЯЗИ";
            document.getElementById('u-dept').innerText = "СЕРВЕР НЕДОСТУПЕН";
        }
    }

    async function sync() {
        try {
            const res = await fetch(`${RENDER_API}/status`);
            const data = await res.json();
            const syncLabel = document.getElementById('sync-val');
            syncLabel.innerText = data.label;
            syncLabel.style.color = data.color;
        } catch(e) {
            document.getElementById('sync-val').innerText = "OFFLINE";
            document.getElementById('sync-val').style.color = "red";
        }
    }

    window.onload = () => { loadData(); sync(); setInterval(sync, 5000); };
</script>
</body>
</html>
