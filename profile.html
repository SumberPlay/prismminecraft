<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>P.R.I.S.M. | Employee Dossier</title>
    <style>
        :root { 
            --neon-green: #00ffcc; 
            --gold: #ffd700;
            --alert: #ff4444;
            --bg-dark: #050505; 
        }
        body { 
            background: var(--bg-dark); 
            color: #d1d1d1; 
            font-family: 'Courier New', monospace; 
            display: flex; 
            flex-direction: column;
            align-items: center;
            padding-top: 50px;
            transition: background 0.5s;
        }

        /* Эффект тревоги */
        body.alarm-mode { background: #1a0505; }
        body.alarm-mode .dossier-card { border-color: var(--alert); box-shadow: 0 0 30px rgba(255, 0, 0, 0.2); }

        .dossier-card {
            width: 600px;
            border: 1px solid #222;
            background: #111;
            padding: 40px;
            position: relative;
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
        }
        .dossier-header {
            display: flex;
            border-bottom: 2px solid var(--neon-green);
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        .photo-stub {
            width: 120px;
            height: 120px;
            border: 1px solid #333;
            background: #0a0a0a;
            margin-right: 30px;
            object-fit: cover;
            image-rendering: pixelated;
        }
        .info-row { margin: 15px 0; font-size: 1.1em; }
        .label { color: #555; text-transform: uppercase; font-size: 0.8em; display: block; }
        .value { color: var(--neon-green); margin-top: 5px; }
        
        /* Темы должностей */
        .council-theme { border-color: var(--gold) !important; }
        .council-text { color: var(--gold) !important; }
        
        .back-btn {
            position: absolute; top: 15px; left: 15px;
            color: #444; text-decoration: none; font-size: 0.8em;
            transition: 0.3s;
        }
        .back-btn:hover { color: var(--neon-green); }

        #sync-indicator {
            margin-top: 20px;
            font-size: 0.7em;
            letter-spacing: 2px;
            color: #333;
        }
    </style>
</head>
<body>

<div class="dossier-card" id="main-card">
    <a href="staff.html" class="back-btn"><-- ВЕРНУТЬСЯ В ТЕРМИНАЛ</a>
    
    <div class="dossier-header" id="header-line">
        <img src="" class="photo-stub" id="user-photo" alt="PHOTO">
        <div>
            <h1 id="name" style="margin: 0; letter-spacing: 3px; text-transform: uppercase;">ЗАГРУЗКА...</h1>
            <p id="id-display" style="color: #444; margin: 5px 0;">ID: NULL</p>
        </div>
    </div>

    <div class="grid">
        <div class="info-row">
            <span class="label">Подразделение</span>
            <div class="value" id="dept">---</div>
        </div>
        <div class="info-row">
            <span class="label">Уровень допуска</span>
            <div class="value" id="level">---</div>
        </div>
        <div class="info-row">
            <span class="label">Специализация</span>
            <div class="value" id="spec">---</div>
        </div>
        <div class="info-row">
            <span class="label">Дата зачисления</span>
            <div class="value" id="joined">---</div>
        </div>
    </div>
</div>

<div id="sync-indicator">СВЯЗЬ: <span id="sync-val">ПОДКЛЮЧЕНИЕ...</span></div>

<script>
    const RENDER_API = "https://prism-bot.onrender.com"; // <--- ТВОЯ ССЫЛКА

    const staffDB = {
        "M4SK": { name: "МэнсиКейн", dept: "Научный Департамент", level: "L3", spec: "Аномалии", joined: "2024", role: "scientific" },
        "KRMP": { name: "Кримпи", dept: "Военная Группа", level: "L3", spec: "Тактика", joined: "2023", role: "military" },
        "SUMBR": { name: "Самбер", dept: "Высший Совет", level: "L5", spec: "Куратор", joined: "2020", role: "council" },
        "MRYZE": { name: "Юз", dept: "Высший Совет", level: "L5", spec: "Стратег", joined: "2020", role: "council" }
    };

    // 1. Синхронизация статуса (RED CODE)
    async function syncSystem() {
        try {
            const res = await fetch(`${RENDER_API}/status`);
            const data = await res.json();
            const val = document.getElementById('sync-val');
            val.innerText = data.label;
            val.style.color = data.color;

            if (data.state === "RED") {
                document.body.classList.add('alarm-mode');
            } else {
                document.body.classList.remove('alarm-mode');
            }
        } catch (e) {
            document.getElementById('sync-val').innerText = "OFFLINE";
        }
    }
    setInterval(syncSystem, 3000);
    syncSystem();

    // 2. Загрузка данных пользователя
    window.onload = function() {
        const uid = sessionStorage.getItem('prism_uid');
        const user = staffDB[uid];

        if (!user) {
            window.location.href = "staff.html";
            return;
        }

        // Заполняем текст
        document.getElementById('name').innerText = user.name;
        document.getElementById('id-display').innerText = "ID: " + uid;
        document.getElementById('dept').innerText = user.dept;
        document.getElementById('level').innerText = user.level;
        document.getElementById('spec').innerText = user.spec;
        document.getElementById('joined').innerText = user.joined;

        // Ставим фото из Minecraft по нику
        document.getElementById('user-photo').src = `https://minotar.net/armor/bust/${uid}/120.png`;

        // Тема совета
        if (user.role === 'council') {
            document.getElementById('header-line').classList.add('council-theme');
            document.getElementById('name').classList.add('council-text');
            document.querySelectorAll('.value').forEach(el => el.classList.add('council-text'));
        }
    };
</script>

</body>
</html>

