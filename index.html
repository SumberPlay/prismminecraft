<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>P.R.I.S.M. | Terminal</title>
    <style>
    :root { 
        --neon-green: #00ffcc; 
        --alert-red: #ff4444; 
        --bg-dark: #050505; 
        --panel-bg: rgba(10, 15, 15, 0.9); 
        --border-color: #1a3a3a;
    }

    body { 
        background: var(--bg-dark); 
        color: #d1d1d1; 
        font-family: 'Courier New', monospace; 
        margin: 0; padding-bottom: 80px;
        font-size: 16px; /* Крупный шрифт */
    }

    body::before {
        content: ""; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background-image: linear-gradient(var(--border-color) 1px, transparent 1px), linear-gradient(90deg, var(--border-color) 1px, transparent 1px);
        background-size: 60px 60px; opacity: 0.05; z-index: -1;
    }

    .container { max-width: 1200px; margin: 40px auto; padding: 0 40px; }

    .main-header {
        text-align: center; padding: 40px; border: 1px solid var(--border-color);
        background: linear-gradient(180deg, rgba(0, 255, 204, 0.05) 0%, transparent 100%);
        margin-bottom: 40px;
    }

    .card { 
        background: var(--panel-bg); border: 1px solid var(--border-color); 
        padding: 30px; margin-bottom: 30px; position: relative;
    }
    
    .card::before { content: ""; position: absolute; top: -1px; left: -1px; width: 20px; height: 20px; border-top: 2px solid var(--neon-green); border-left: 2px solid var(--neon-green); }
    .card::after { content: ""; position: absolute; bottom: -1px; right: -1px; width: 20px; height: 20px; border-bottom: 2px solid var(--neon-green); border-right: 2px solid var(--neon-green); }

    .status-bar {
        border: 1px solid var(--border-color); padding: 25px 40px; 
        display: flex; justify-content: space-between; align-items: center;
        background: rgba(0, 255, 204, 0.02); margin-bottom: 40px;
    }

    .dot { width: 14px; height: 14px; background: var(--neon-green); box-shadow: 0 0 12px var(--neon-green); animation: pulse 1.5s infinite; }

    .btn {
        background: rgba(0, 255, 204, 0.05); border: 1px solid var(--neon-green);
        color: var(--neon-green); padding: 15px 35px; cursor: pointer;
        text-transform: uppercase; font-size: 1em; transition: 0.3s; letter-spacing: 2px;
    }
    .btn:hover { background: var(--neon-green); color: #000; box-shadow: 0 0 20px var(--neon-green); }

    #system-log { height: 200px; overflow-y: auto; font-size: 0.95em; color: #008877; scrollbar-width: none; }
    #mini-console-output { height: 80px; overflow: hidden; font-size: 0.9em; display: flex; flex-direction: column-reverse; color: #666; }

    @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }
    
    input { background: transparent; border: none; color: #fff; outline: none; font-family: inherit; width: 100%; font-size: 1.1em; }
    
    .counter-num { font-size: 3.5em; color: var(--neon-green); font-weight: bold; text-shadow: 0 0 15px rgba(0,255,204,0.2); }
    
    nav { background: #000; padding: 25px; border-bottom: 1px solid var(--border-color); text-align: center; }
    nav a { color: #555; text-decoration: none; padding: 0 25px; font-size: 1em; letter-spacing: 3px; }
    nav a:hover { color: var(--neon-green); }

    #emergency-alert { display: none; position: fixed; bottom: 0; width: 100%; background: var(--alert-red); color: #000; padding: 20px; z-index: 9999; font-weight: bold; text-align: center; font-size: 1.2em; }
    </style>
</head>
<body>

<nav>
    <a href="#" style="color: var(--neon-green);">[ MAIN ]</a>
    <a href="storage.html">ARCHIVE</a>
    <a href="dossier.html">DOSSIER</a>
    <a href="staff.html">TERMINAL</a>
</nav>

<div id="emergency-alert">SYSTEM CRITICAL ERROR - DATA BREACH DETECTED</div>

<div class="container">
    <div class="main-header">
        <h2 style="letter-spacing: 15px; color: var(--neon-green); margin: 0; font-size: 3em;">P.R.I.S.M.</h2>
        <div style="font-size: 0.8em; letter-spacing: 5px; color: #444; margin-top: 15px; text-transform: uppercase;">
            Proactive Reaction, Immediate Solution, Minimization of Anomalies
        </div>
    </div>

    <div class="status-bar">
        <div style="display: flex; align-items: center; gap: 20px;">
            <div class="dot" id="status-dot"></div>
            <div>
                <div style="font-size: 0.7em; color: #555;">SYSTEM_INTEGRITY</div>
                <div id="status-text" style="font-weight: bold; color: var(--neon-green); font-size: 1.2em;">CONNECTING...</div>
            </div>
        </div>
        <div style="text-align: right;">
            <div style="font-size: 0.7em; color: #555;">SERVER_TIME</div>
            <div id="clock" style="color: var(--neon-green); font-size: 1.3em;">00:00:00</div>
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
        <div class="card">
            <div style="font-size: 0.7em; color: #444; margin-bottom: 15px;">CONNECTION_METRICS</div>
            <div id="user-info" style="font-size: 1em; line-height: 1.8;">
                <div>IP: <span id="user-ip" style="color: var(--neon-green);">127.0.0.1</span></div>
                <div>LOC: <span id="user-loc" style="color: var(--neon-green);">SCANNING...</span></div>
                <div>SEC: <span style="color: var(--neon-green);">ENCRYPTED</span></div>
            </div>
        </div>

        <div class="card" style="background: rgba(0,0,0,0.5); min-height: 160px; display: flex; flex-direction: column;">
            <div style="font-size: 0.7em; color: #444; margin-bottom: 10px;">USER_CONSOLE</div>
            <div id="mini-console-output" style="flex-grow: 1; overflow: hidden; display: flex; flex-direction: column-reverse; gap: 5px;">
                <div>Waiting for input...</div>
            </div>
            <div style="display: flex; border-top: 1px solid #1a1a1a; padding-top: 15px; margin-top: auto;">
                <span style="color: var(--neon-green); margin-right: 12px; font-weight: bold;">></span>
                <input type="text" id="user-input" placeholder="Enter command..." autocomplete="off" spellcheck="false" autofocus>
            </div>
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
        <div class="card" style="text-align: center;">
            <div style="font-size: 0.7em; color: #444;">COLLAPSE_RISK</div>
            <div class="counter-num" id="risk-percent">0.0000%</div>
        </div>
        <div class="card" style="text-align: center;">
            <div style="font-size: 0.7em; color: #444;">RESONANCE_ID</div>
            <div class="counter-num" id="resonance-index">1.0000</div>
        </div>
    </div>

    <div class="card" style="background: #000;">
        <div style="font-size: 0.7em; color: #444; border-bottom: 1px solid #111; padding-bottom: 10px; margin-bottom: 15px;">LIVE_SYSTEM_FEED</div>
        <div id="system-log"></div>
    </div>

    <div class="card">
        <div style="font-size: 0.7em; color: #444; border-bottom: 1px solid #111; padding-bottom: 10px; margin-bottom: 25px;">ARCHIVE_ENTRY_#042</div>
        <h3 style="color: var(--neon-green); margin-top: 0; letter-spacing: 4px; font-size: 1.8em;">OBJECTIVE_DATA</h3>
        
        <div style="max-width: 900px; margin: 0 auto; color: #aaa;">
            <p style="line-height: 1.8; border-left: 4px solid var(--neon-green); padding-left: 25px; margin-bottom: 30px;">
                <strong style="color: #fff;">Статус независимости:</strong> Мы являемся независимой структурой. Отсутствие какой-либо зависимости позволяет нам принимать решения с максимальной скоростью и эффективностью.
            </p>
            <p style="line-height: 1.8; border-left: 4px solid #333; padding-left: 25px; margin-bottom: 30px;">
                <strong style="color: #fff;">Политика конфиденциальности:</strong> Информация о деятельности организации является засекреченной и предоставляется общественности ровно в том объеме, который не нарушает работу организации для поддержания доверия.
            </p>
            <p style="line-height: 1.8; border-left: 4px solid #333; padding-left: 25px; margin-bottom: 30px;">
                <strong style="color: #fff;">Структура управления:</strong> Вопреки расхожему мнению, Высший Совет выполняет исполнительные функции. Личности Создателей остаются анонимными для обеспечения непрерывности функционирования Системы в любых условиях.
            </p>
            <p style="line-height: 1.8; border-left: 4px solid #333; padding-left: 25px; margin-bottom: 30px;">
                <strong style="color: #fff;">Определение Аномалий:</strong> К аномальным объектам относятся негуманоидные субъекты, обладающие дестабилизирующими способностями, а также события, нарушающие базовые законы физики.
            </p>
            <p style="line-height: 1.8; border-left: 4px solid #333; padding-left: 25px; margin-bottom: 30px;">
                <strong style="color: #fff;">Примечание:</strong> Пост-миграционные модификаторы расы (включая мир Блинк) классифицируются как адаптивные изменения и не являются признаком аномалии.
            </p>
            <p style="text-align: center; color: var(--neon-green); font-weight: bold; margin-top: 50px; letter-spacing: 6px; font-size: 1.2em;">
                ЗНАНИЕ — ЭТО ЩИТ. МЫ ДЕРЖИМ ЕГО ДЛЯ ВАС.
            </p>
        </div>

        <div style="text-align: center; margin-top: 50px; border-top: 1px dashed var(--border-color); padding-top: 40px;">
            <button class="btn" onclick="location.href='staff.html'">IDENTIFY_PERSONNEL</button>
        </div>
    </div>
</div>

<script>
    const RENDER_API = "https://prism-bot.onrender.com";

    // 1. Часы
    setInterval(() => {
        const clockElem = document.getElementById('clock');
        if(clockElem) clockElem.innerText = new Date().toLocaleTimeString();
    }, 1000);

    // 2. Логирование (Базовая функция)
    function sysLog(msg, type = 'INFO') {
        const log = document.getElementById('system-log');
        if(!log) return;
        const colors = { 'INFO': '#00ffcc', 'WARN': '#ffd700', 'ERROR': '#ff4444', 'CORE': '#ff00ff' };
        const line = document.createElement('div');
        line.style.marginBottom = "6px";
        line.innerHTML = `<span style="color: #444;">[${new Date().toLocaleTimeString()}]</span> <span style="color: ${colors[type]}">${type}</span> > ${msg}`;
        log.prepend(line);
        if (log.children.length > 15) log.removeChild(log.lastChild);
    }

    // 3. Атмосферные логи (ВЕРНУЛ ВСЁ ОБРАТНО)
    function generateBackgroundLog() {
        const templates = [
            () => `Поток данных Alpha-${Math.floor(Math.random()*10)}: СТАБИЛЕН.`,
            () => `Резонанс Разлома: ${document.getElementById('resonance-index') ? document.getElementById('resonance-index').innerText : '0.000'}`,
            () => `Целостность оболочки: ${(99 + Math.random()).toFixed(3)}%`,
            () => `Температура ядра: ${(35 + Math.random()*20).toFixed(1)}°C`,
            () => `Сканирование сектора ${(Math.random()*100).toFixed(0)}: УГРОЗ НЕ ОБНАРУЖЕНО.`,
            () => `Анализ входящих пакетов... OK.`,
            () => `Связь с узлом Delta установлена. Пинг: ${(Math.random()*50).toFixed(0)}ms`,
            () => `Мониторинг аномалий: Уровень активности МИНИМАЛЬНЫЙ.`,
            () => `Uptime терминала: ${(performance.now() / 1000).toFixed(0)} сек.`,
            () => {
                const hour = new Date().getHours();
                const mode = (hour > 20 || hour < 6) ? "NIGHT_VISION" : "DAY_LIGHT";
                return `Режим фильтрации: ${mode}.`;
            },
            () => `Использование памяти ядра: ${(Math.random() * 40 + 10).toFixed(2)} MB / 256 MB`,
            () => `Активная зона захвата: ${window.innerWidth}x${window.innerHeight}`,
            () => `Протокол синхронизации P.R.I.S.M. v2.0.26 активен.`,
            () => `Обнаружен физический контакт с интерфейсом.`,
            () => `Калибровка датчиков: Ошибка 0.000${Math.floor(Math.random()*9)}%`
        ];

        const randomMsg = templates[Math.floor(Math.random() * templates.length)]();
        sysLog(randomMsg, 'INFO');
        setTimeout(generateBackgroundLog, Math.random() * 3000 + 2000); // Чуть быстрее для динамики
    }

    // 4. Движение мыши (ВЕРНУЛ)
    let lastMoveLog = 0;
    window.addEventListener('mousemove', (e) => {
        let now = Date.now();
        if (now - lastMoveLog > 8000) { // Каждые 8 секунд, чтобы не спамить сильно
            sysLog(`Сканирование биометрии [X:${e.clientX} Y:${e.clientY}]... OK`, 'CORE');
            lastMoveLog = now;
        }
    });

    // 5. Консоль
    function executeCmd(cmd) {
        const miniOut = document.getElementById('mini-console-output');
        sysLog(`Exec: ${cmd.toUpperCase()}`, "CORE");
        
        if (cmd === 'help') sysLog("Commands: status, clear, reboot, protocol", "INFO");
        else if (cmd === 'clear') { 
            document.getElementById('system-log').innerHTML = ''; 
            if(miniOut) miniOut.innerHTML = '<div>Console cleared.</div>'; 
        }
        else if (cmd === 'reboot') { sysLog("Rebooting terminal...", "ERROR"); setTimeout(() => location.reload(), 1000); }
        else if (cmd === 'status') sysLog("All systems nominal. Link: STABLE.", "INFO");
        else if (cmd === 'protocol') sysLog("PRISM Protocol v2.0 active.", "CORE");
        else sysLog(`Unknown command: ${cmd}`, "WARN");
    }

    // 6. API и Данные
    async function fetchVisitorData() {
        try {
            const res = await fetch('https://ipapi.co/json/');
            const data = await res.json();
            document.getElementById('user-ip').innerText = data.ip || "127.0.0.1";
            document.getElementById('user-loc').innerText = `${data.city || 'Unknown'}, ${data.country_code || '??'}`;
            sysLog("User biometrics synchronized.", "CORE");
        } catch (e) {
            sysLog("Proxy mode active. Location hidden.", "WARN");
        }
    }

    async function syncPrism() {
        try {
            const response = await fetch(`${RENDER_API}/status`);
            const data = await response.json();
            updateUI(data.state, data.label, data.color);
        } catch (e) {
            updateUI("NORMAL", "LOCAL_ACTIVE", "#00ffcc");
        }
    }

    function updateUI(state, label, color) {
        const statusTxt = document.getElementById('status-text');
        const statusDot = document.getElementById('status-dot');
        const alertBanner = document.getElementById('emergency-alert');
        
        if(statusTxt) { statusTxt.innerText = label.toUpperCase(); statusTxt.style.color = color; }
        if(statusDot) { statusDot.style.backgroundColor = color; statusDot.style.boxShadow = `0 0 10px ${color}`; }
        
        if (state === "RED") {
            if(alertBanner) alertBanner.style.display = "block";
            document.body.style.backgroundColor = "#100";
        } else {
            if(alertBanner) alertBanner.style.display = "none";
            document.body.style.backgroundColor = "#050505";
        }
    }

    // ИНИЦИАЛИЗАЦИЯ
    window.onload = () => {
        const input = document.getElementById('user-input');
        const miniOut = document.getElementById('mini-console-output');

        if (input) {
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    const val = input.value.trim();
                    if (val) {
                        const l = document.createElement('div');
                        l.style.borderLeft = "2px solid #333";
                        l.style.paddingLeft = "10px";
                        l.innerHTML = `<span style="color: var(--neon-green)">></span> ${val.toUpperCase()}`;
                        
                        if (miniOut) {
                            miniOut.prepend(l);
                            if (miniOut.children.length > 5) miniOut.removeChild(miniOut.lastChild);
                        }
                        executeCmd(val.toLowerCase());
                    }
                    input.value = '';
                }
            });
            input.focus();
            document.addEventListener('click', () => input.focus());
        }

        fetchVisitorData();
        generateBackgroundLog(); // <-- ВОТ ОНО, ЗАПУСКАЕМ ГЕНЕРАТОР БРЕДА
        setInterval(syncPrism, 5000);
        
        // Рандомные показатели
        setInterval(() => {
            const risk = document.getElementById('risk-percent');
            const res = document.getElementById('resonance-index');
            if(risk) risk.innerText = (0.001 + Math.random() * 0.005).toFixed(4) + "%";
            if(res) res.innerText = (1.0000 + Math.sin(Date.now()/2000)*0.001).toFixed(4);
        }, 300);

        sysLog("Terminal P.R.I.S.M. v2.0 - Online", "CORE");
    };
</script>
</body>
</html>


