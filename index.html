<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>P.R.I.S.M. | Terminal</title>
    <style>
    :root { 
        --neon-green: #00ffcc; 
        --alert-red: #ff4444; 
        --bg-dark: #050505; 
        --panel-bg: rgba(10, 15, 15, 0.9); 
        --border-color: #1a3a3a;
    }

    body { 
        background: var(--bg-dark); 
        color: #d1d1d1; 
        font-family: 'Courier New', monospace; 
        margin: 0; padding-bottom: 60px;
        font-size: 16px; /* Чуть больше шрифт */
    }

    body::before {
        content: ""; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background-image: linear-gradient(var(--border-color) 1px, transparent 1px), linear-gradient(90deg, var(--border-color) 1px, transparent 1px);
        background-size: 50px 50px; opacity: 0.05; z-index: -1;
    }

    .container { max-width: 1200px; margin: 30px auto; padding: 0 30px; }

    .main-header {
        text-align: center; padding: 30px; border: 1px solid var(--border-color);
        background: linear-gradient(180deg, rgba(0, 255, 204, 0.03) 0%, transparent 100%);
        margin-bottom: 30px;
    }

    .card { 
        background: var(--panel-bg); border: 1px solid var(--border-color); 
        padding: 25px; margin-bottom: 25px; position: relative;
    }
    
    .card::before { content: ""; position: absolute; top: -1px; left: -1px; width: 15px; height: 15px; border-top: 2px solid var(--neon-green); border-left: 2px solid var(--neon-green); }
    .card::after { content: ""; position: absolute; bottom: -1px; right: -1px; width: 15px; height: 15px; border-bottom: 2px solid var(--neon-green); border-right: 2px solid var(--neon-green); }

    .status-bar {
        border: 1px solid var(--border-color); padding: 20px 30px; 
        display: flex; justify-content: space-between; align-items: center;
        background: rgba(0, 255, 204, 0.02); margin-bottom: 30px;
    }

    .dot { width: 12px; height: 12px; background: var(--neon-green); box-shadow: 0 0 10px var(--neon-green); animation: pulse 1.5s infinite; }

    .btn {
        background: rgba(0, 255, 204, 0.05); border: 1px solid var(--neon-green);
        color: var(--neon-green); padding: 12px 30px; cursor: pointer;
        text-transform: uppercase; font-size: 0.9em; transition: 0.3s;
    }
    .btn:hover { background: var(--neon-green); color: #000; box-shadow: 0 0 15px var(--neon-green); }

    #system-log { height: 160px; overflow-y: auto; font-size: 0.9em; color: #008877; scrollbar-width: none; }
    #mini-console-output { height: 70px; overflow: hidden; font-size: 0.85em; display: flex; flex-direction: column-reverse; color: #666; }

    @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }
    
    input { background: transparent; border: none; color: #fff; outline: none; font-family: inherit; width: 100%; font-size: 1em; }
    
    .counter-num { font-size: 2.8em; color: var(--neon-green); font-weight: bold; }
    
    nav { background: #000; padding: 20px; border-bottom: 1px solid var(--border-color); text-align: center; }
    nav a { color: #444; text-decoration: none; padding: 0 20px; font-size: 0.9em; letter-spacing: 2px; }
    nav a:hover { color: var(--neon-green); }

    #emergency-alert { display: none; position: fixed; bottom: 0; width: 100%; background: var(--alert-red); color: #000; padding: 15px; z-index: 9999; font-weight: bold; text-align: center; }
    </style>
</head>
<body>

<nav>
    <a href="#" style="color: var(--neon-green);">[ MAIN ]</a>
    <a href="#">ARCHIVE</a>
    <a href="#">DOSSIER</a>
    <a href="#">TERMINAL</a>
</nav>

<div id="emergency-alert">SYSTEM CRITICAL ERROR - DATA BREACH DETECTED</div>

<div class="container">
    <div class="main-header">
        <h2 style="letter-spacing: 12px; color: var(--neon-green); margin: 0; font-size: 2.5em;">P.R.I.S.M.</h2>
        <div style="font-size: 0.7em; letter-spacing: 4px; color: #444; margin-top: 10px; text-transform: uppercase;">
            Proactive Reaction, Immediate Solution & Minimization of Anomalies
        </div>
    </div>

    <div class="status-bar">
        <div style="display: flex; align-items: center; gap: 20px;">
            <div class="dot" id="status-dot"></div>
            <div>
                <div style="font-size: 0.65em; color: #555;">SYSTEM_INTEGRITY</div>
                <div id="status-text" style="font-weight: bold; color: var(--neon-green);">CONNECTING...</div>
            </div>
        </div>
        <div style="text-align: right;">
            <div style="font-size: 0.65em; color: #555;">SERVER_TIME</div>
            <div id="clock" style="color: var(--neon-green); font-size: 1.1em;">00:00:00</div>
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-bottom: 25px;">
        <div class="card">
            <div style="font-size: 0.65em; color: #444; margin-bottom: 12px;">CONNECTION_METRICS</div>
            <div id="user-info" style="font-size: 0.95em; line-height: 1.8;">
                <div>IP: <span id="user-ip" style="color: var(--neon-green);">127.0.0.1</span></div>
                <div>LOC: <span id="user-loc" style="color: var(--neon-green);">SCANNING...</span></div>
                <div>SEC: <span style="color: var(--neon-green);">ENCRYPTED</span></div>
            </div>
        </div>

        <div class="card" style="background: rgba(0,0,0,0.5); min-height: 140px; display: flex; flex-direction: column;">
            <div style="font-size: 0.65em; color: #444; margin-bottom: 8px;">USER_CONSOLE</div>
            <div id="mini-console-output" style="flex-grow: 1; overflow-y: hidden; display: flex; flex-direction: column-reverse; gap: 4px;">
                <div>Waiting for input...</div>
            </div>
            <div style="display: flex; border-top: 1px solid #1a1a1a; padding-top: 12px; margin-top: auto;">
                <span style="color: var(--neon-green); margin-right: 10px; font-weight: bold;">></span>
                <input type="text" id="user-input" placeholder="Type command..." autocomplete="off" spellcheck="false">
            </div>
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-bottom: 25px;">
        <div class="card" style="text-align: center;">
            <div style="font-size: 0.65em; color: #444;">COLLAPSE_RISK</div>
            <div class="counter-num" id="risk-percent">0.0000%</div>
        </div>
        <div class="card" style="text-align: center;">
            <div style="font-size: 0.65em; color: #444;">RESONANCE_ID</div>
            <div class="counter-num" id="resonance-index">1.0000</div>
        </div>
    </div>

    <div class="card" style="background: #000;">
        <div style="font-size: 0.65em; color: #444; border-bottom: 1px solid #111; padding-bottom: 8px; margin-bottom: 12px;">LIVE_SYSTEM_FEED</div>
        <div id="system-log"></div>
    </div>

    <div class="card">
        <div style="font-size: 0.65em; color: #444; border-bottom: 1px solid #111; padding-bottom: 8px; margin-bottom: 20px;">ARCHIVE_ENTRY_#042</div>
        <h3 style="color: var(--neon-green); margin-top: 0; letter-spacing: 3px;">OBJECTIVE_DATA</h3>
        
        <div style="max-width: 900px; margin: 0 auto; color: #aaa;">
            <p style="line-height: 1.7; border-left: 3px solid var(--neon-green); padding-left: 20px; margin-bottom: 25px;">
                <strong style="color: #fff;">Статус независимости:</strong> Мы являемся независимой структурой. Отсутствие какой-либо зависимости позволяет нам принимать решения с максимальной скоростью и эффективностью.
            </p>
            <p style="line-height: 1.7; border-left: 3px solid #333; padding-left: 20px; margin-bottom: 25px;">
                <strong style="color: #fff;">Политика конфиденциальности:</strong> Информация засекречена и предоставляется в объеме, необходимом для поддержания доверия.
            </p>
            <p style="line-height: 1.7; border-left: 3px solid #333; padding-left: 20px; margin-bottom: 25px;">
                <strong style="color: #fff;">Структура управления:</strong> Личности Создателей анонимны для обеспечения непрерывности функционирования Системы.
            </p>
            <p style="line-height: 1.7; border-left: 3px solid #333; padding-left: 20px; margin-bottom: 25px;">
                <strong style="color: #fff;">Определение Аномалий:</strong> К аномалиям относятся объекты, нарушающие законы физики.
            </p>
            <p style="text-align: center; color: var(--neon-green); font-weight: bold; margin-top: 40px; letter-spacing: 5px; font-size: 1.1em;">
                ЗНАНИЕ — ЭТО ЩИТ. МЫ ДЕРЖИМ ЕГО ДЛЯ ВАС.
            </p>
        </div>

        <div style="text-align: center; margin-top: 40px; border-top: 1px dashed var(--border-color); padding-top: 30px;">
            <button class="btn" onclick="location.href='staff.html'">IDENTIFY_PERSONNEL</button>
        </div>
    </div> 

<script>
    const RENDER_API = "https://prism-bot.onrender.com";

    // 1. Часы
    setInterval(() => {
        const clockElem = document.getElementById('clock');
        if(clockElem) clockElem.innerText = new Date().toLocaleTimeString();
    }, 1000);

    // 2. Логирование
    function sysLog(msg, type = 'INFO') {
        const log = document.getElementById('system-log');
        if(!log) return;
        const colors = { 'INFO': '#00ffcc', 'WARN': '#ffd700', 'ERROR': '#ff4444', 'CORE': '#ff00ff' };
        const line = document.createElement('div');
        line.style.marginBottom = "4px";
        line.innerHTML = `<span style="color: #444;">[${new Date().toLocaleTimeString()}]</span> <span style="color: ${colors[type]}">${type}</span> > ${msg}`;
        log.prepend(line);
        if (log.children.length > 15) log.removeChild(log.lastChild);
    }

    // 3. Консоль (Улучшенная инициализация)
    function initConsole() {
        const input = document.getElementById('user-input');
        const miniOut = document.getElementById('mini-console-output');

        if (input) {
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    const val = input.value.trim();
                    if (val) {
                        const l = document.createElement('div');
                        l.style.borderLeft = "2px solid #333";
                        l.style.paddingLeft = "8px";
                        l.innerHTML = `<span style="color: var(--neon-green)">></span> ${val.toUpperCase()}`;
                        
                        if (miniOut) {
                            miniOut.prepend(l);
                            if (miniOut.children.length > 4) miniOut.removeChild(miniOut.lastChild);
                        }
                        executeCmd(val.toLowerCase());
                    }
                    input.value = '';
                }
            });
        }
    }

    function executeCmd(cmd) {
        sysLog(`Exec: ${cmd.toUpperCase()}`, "CORE");
        if (cmd === 'help') sysLog("Commands: status, clear, reboot, protocol", "INFO");
        else if (cmd === 'clear') { 
            document.getElementById('system-log').innerHTML = ''; 
            document.getElementById('mini-console-output').innerHTML = '<div>Console cleared.</div>'; 
        }
        else if (cmd === 'reboot') { sysLog("Rebooting terminal...", "ERROR"); setTimeout(() => location.reload(), 1000); }
        else if (cmd === 'status') sysLog("All systems nominal. Link: STABLE.", "INFO");
        else if (cmd === 'protocol') sysLog("PRISM Protocol v2.0.26 active. Firewall: ON.", "CORE");
        else sysLog(`Unknown command: ${cmd}`, "WARN");
    }

    // 4. API и Данные
    async function fetchVisitorData() {
        try {
            const res = await fetch('https://ipapi.co/json/');
            const data = await res.json();
            document.getElementById('user-ip').innerText = data.ip || "127.0.0.1";
            document.getElementById('user-loc').innerText = `${data.city || 'Unknown'}, ${data.country_code || '??'}`;
            sysLog("User biometrics synchronized.", "CORE");
        } catch (e) {
            sysLog("Network error: Using proxy defaults.", "WARN");
        }
    }

    async function syncPrism() {
        try {
            const response = await fetch(`${RENDER_API}/status`);
            const data = await response.json();
            updateUI(data.state, data.label, data.color);
        } catch (e) {
            updateUI("NORMAL", "LOCAL_ACTIVE", "#00ffcc");
        }
    }

    function updateUI(state, label, color) {
        const statusTxt = document.getElementById('status-text');
        const statusDot = document.getElementById('status-dot');
        if(statusTxt) { statusTxt.innerText = label.toUpperCase(); statusTxt.style.color = color; }
        if(statusDot) { statusDot.style.backgroundColor = color; statusDot.style.boxShadow = `0 0 10px ${color}`; }
    }

    // 5. Фон и эффекты
    function generateBackgroundLog() {
        const templates = [
            "Pulsing node Delta-9...", "Cache synchronized.", "Scanning for anomalies...",
            "Resonance stable.", "Atmosphere pressure: 1.012 bar", "Sub-space link OK."
        ];
        sysLog(templates[Math.floor(Math.random()*templates.length)], "INFO");
        setTimeout(generateBackgroundLog, Math.random() * 5000 + 5000);
    }

    // Запуск
    window.onload = () => {
        initConsole();
        fetchVisitorData();
        generateBackgroundLog();
        setInterval(syncPrism, 10000);
        
        setInterval(() => {
            document.getElementById('risk-percent').innerText = (0.001 + Math.random() * 0.005).toFixed(4) + "%";
            document.getElementById('resonance-index').innerText = (1.0000 + Math.sin(Date.now()/2000)*0.001).toFixed(4);
        }, 300);

        sysLog("P.R.I.S.M. Terminal v2.0 initialized.", "INFO");
    };
</script>
</body>
</html>
