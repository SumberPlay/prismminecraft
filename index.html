<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>P.R.I.S.M. | Public Portal</title>
    <style>
    :root { 
        --neon-green: #00ffcc; 
        --alert-red: #ff4444; 
        --bg-dark: #050505; 
        --panel-bg: rgba(10, 15, 15, 0.9); 
        --border-color: #1a3a3a;
    }

    body { 
        background: var(--bg-dark); 
        color: #d1d1d1; 
        font-family: 'Courier New', monospace; 
        margin: 0; 
        overflow-x: hidden; 
        padding-bottom: 60px; 
    }

    body::before {
        content: "";
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background-image: 
            linear-gradient(var(--border-color) 1px, transparent 1px),
            linear-gradient(90deg, var(--border-color) 1px, transparent 1px);
        background-size: 50px 50px;
        opacity: 0.05;
        pointer-events: none;
        z-index: -1;
    }

    .overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: repeating-linear-gradient(0deg, rgba(0,0,0,0.05) 0px, transparent 1px);
        pointer-events: none; z-index: 1000;
    }

    nav { 
        background: rgba(0,0,0,0.9); 
        padding: 20px; 
        border-bottom: 1px solid var(--border-color); 
        text-align: center;
        backdrop-filter: blur(5px);
    }
    nav a { 
        color: #555; text-decoration: none; text-transform: uppercase; 
        padding: 0 25px; transition: 0.3s; font-weight: bold; font-size: 0.9em;
        letter-spacing: 2px;
    }
    nav a:hover { color: var(--neon-green); text-shadow: 0 0 10px var(--neon-green); }

    .container { max-width: 1100px; margin: 40px auto; padding: 0 20px; }

    .main-header {
        text-align: center; margin-bottom: 60px;
        border: 1px solid var(--border-color);
        padding: 40px;
        background: linear-gradient(180deg, rgba(0, 255, 204, 0.05) 0%, transparent 100%);
        position: relative;
    }

    .card { 
        background: var(--panel-bg); 
        border: 1px solid var(--border-color); 
        padding: 30px; 
        margin-bottom: 25px; 
        position: relative;
        box-shadow: inset 0 0 20px rgba(0,0,0,0.5);
    }
    .card::before {
        content: ""; position: absolute; top: -1px; left: -1px; width: 15px; height: 15px;
        border-top: 2px solid var(--neon-green); border-left: 2px solid var(--neon-green);
    }
    .card::after {
        content: ""; position: absolute; bottom: -1px; right: -1px; width: 15px; height: 15px;
        border-bottom: 2px solid var(--neon-green); border-right: 2px solid var(--neon-green);
    }

    .status-bar {
        border: 1px solid var(--border-color); padding: 25px; 
        display: flex; justify-content: space-between; align-items: center;
        background: rgba(0, 255, 204, 0.02);
        margin-bottom: 35px;
    }

    .dot {
        width: 14px; height: 14px; border-radius: 2px;
        background: var(--neon-green);
        box-shadow: 0 0 15px var(--neon-green);
        animation: pulse 1.5s infinite;
    }

    .btn {
        background: rgba(0, 255, 204, 0.05); border: 1px solid var(--neon-green);
        color: var(--neon-green); padding: 15px 40px; cursor: pointer;
        text-transform: uppercase; font-weight: bold; transition: 0.4s;
        letter-spacing: 3px;
    }
    .btn:hover { 
        background: var(--neon-green); color: #000; 
        box-shadow: 0 0 25px var(--neon-green); 
    }

    #emergency-alert {
        display: none; position: fixed; bottom: 0; left: 0; width: 100%;
        background: var(--alert-red); color: #000; padding: 15px 0;
        font-weight: 900; z-index: 2000; text-transform: uppercase;
        border-top: 2px solid #000;
        border-bottom: 2px solid #000;
        box-shadow: 0 0 30px var(--alert-red);
    }

    .scanline {
        position: fixed; top: 0; left: 0; width: 100%; height: 4px;
        background: rgba(0, 255, 204, 0.05);
        z-index: 1001; pointer-events: none;
        animation: scan 10s linear infinite;
    }

    @keyframes scan { from { top: -5%; } to { top: 105%; } }
    @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }

    .counter-num { display: block; font-size: 3em; color: var(--neon-green); text-shadow: 0 0 10px rgba(0, 255, 204, 0.3); }

    .alert-marquee {
        white-space: nowrap;
        display: inline-block;
        animation: marquee 30s linear infinite;
        font-size: 1.2em;
        letter-spacing: 5px;
    }

    @keyframes marquee {
        from { transform: translateX(0); }
        to { transform: translateX(-50%); }
    }
    </style>
</head>
<body>

<div class="overlay"></div><div class="scanline"></div>
<audio id="alarm-sound" loop><source src="alarm.mp3" type="audio/mpeg"></audio>
<div id="emergency-alert"></div>

<nav>
    <a href="index.html" style="color: var(--neon-green);">[ –ì–õ–ê–í–ù–ê–Ø ]</a>
    <a href="storage.html">–ë–ò–ë–õ–ò–û–¢–ï–ö–ê</a>
    <a href="dossier.html">–õ–ò–ß–ù–´–ï –î–ï–õ–ê</a>
    <a href="staff.html">–¢–ï–†–ú–ò–ù–ê–õ</a>
</nav>

<div class="container">
    <div class="main-header">
        <h1 style="letter-spacing: 20px; color: var(--neon-green); margin: 0; font-size: 3em;">P.R.I.S.M.</h1>
        <p style="color: #555; margin-top: 15px; letter-spacing: 2px;">Proactive Reaction, Immediate Solution & Minimization of Anomalies.</p>
    </div>

    <div class="status-bar">
        <div style="display: flex; align-items: center; gap: 20px;">
            <div class="dot" id="status-dot"></div>
            <div>
                <div style="font-size: 0.7em; color: #666; letter-spacing: 1px;">SYSTEM_INTEGRITY</div>
                <div id="status-text" style="font-weight: bold; letter-spacing: 2px;">CONNECTING...</div>
            </div>
        </div>
        <div style="text-align: right;">
            <div style="font-size: 0.7em; color: #666;">SERVER_TIME</div>
            <div id="clock" style="color: var(--neon-green); font-weight: bold;">00:00:00</div>
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-bottom: 25px;">
    <div class="card" style="margin-bottom: 0;">
        <div style="font-size: 0.7em; color: #444; margin-bottom: 10px; border-bottom: 1px solid #1a3a3a; padding-bottom: 5px;">CONNECTION_METRICS</div>
        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div id="user-info" style="font-size: 0.9em; line-height: 1.8;">
                <div>NODE_IP: <span id="user-ip" style="color: var(--neon-green);">LOADING...</span></div>
                <div>LOCATION: <span id="user-loc" style="color: var(--neon-green);">DETECTING...</span></div>
                <div>STATUS: <span style="color: var(--neon-green);">AUTHORIZED</span></div>
            </div>
            <div style="text-align: right; border-left: 1px solid #1a3a3a; padding-left: 20px;">
                <div style="font-size: 0.7em; color: #666;">TECH_STACK</div>
                <div style="color: var(--neon-green); font-size: 0.8em; margin-top: 5px;">
                    NODE.JS v22<br>EXPRESS JS<br>SUPABASE_DB
                </div>
            </div>
        </div>
    </div>

    <div class="card" style="margin-bottom: 0; background: rgba(0,0,0,0.4);">
        <div style="font-size: 0.7em; color: #444; margin-bottom: 10px; border-bottom: 1px solid #1a3a3a; padding-bottom: 5px;">USER_COMMAND_INTERFACE</div>
        <div id="console-output" style="height: 60px; font-size: 0.8em; color: #888; overflow: hidden; margin-bottom: 10px; display: flex; flex-direction: column-reverse;">
            <div style="color: #444;">–û–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞...</div>
        </div>
        <div style="display: flex; gap: 5px; align-items: center; border-top: 1px solid #1a1a1a; padding-top: 10px;">
            <span style="color: var(--neon-green); font-size: 0.9em;">></span>
            <input type="text" id="user-input" 
                   style="background: transparent; border: none; color: #fff; outline: none; font-family: 'Courier New', monospace; flex: 1; font-size: 0.9em;" 
                   placeholder="–ö–æ–º–∞–Ω–¥–∞..." autofocus>
        </div>
    </div>
</div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px;">
        <div class="card" style="text-align: center;">
            <span style="font-size: 0.7em; color: #666;">PROBABILITY_OF_COLLAPSE</span>
            <span class="counter-num" id="risk-percent">0.0031%</span>
        </div>
        <div class="card" style="text-align: center;">
            <span style="font-size: 0.7em; color: #666;">RIFT_RESONANCE_INDEX</span>
            <span class="counter-num" id="resonance-index">1.0000</span>
        </div>
    </div>

    <div class="card" style="background: #000; border-color: #1a1a1a;">
        <div style="font-size: 0.7em; color: #444; margin-bottom: 15px; border-bottom: 1px solid #1a1a1a; padding-bottom: 5px;">LIVE_CONSOLE_FEED v2.0.26</div>
        <div id="system-log" style="height: 150px; overflow: hidden; font-size: 0.85em; color: #008877; line-height: 1.4;"></div>
    </div>

    <div class="card">
        <h3 style="color: var(--neon-green); margin-top: 0;">OBJECTIVE_DATA</h3>
        <p style="line-height: 1.6;">–ú—ã ‚Äî –≤–Ω–µ–≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, —Å–æ–∑–¥–∞–Ω–Ω–∞—è –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∞–Ω–æ–º–∞–ª–∏–π. –ù–∞—à–∞ –∑–∞–¥–∞—á–∞: –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–π –¥–µ—Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏. –ú—ã - –≥–∞—Ä–∞–Ω—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤—Å–µ–ª–µ–Ω–Ω–æ–π –∏ –≤—Å–µ—Ö –ª—é–¥–µ–π –≤ –Ω–µ–π.</p>
        <p style="line-height: 1.6;">–ù–∞ —ç—Ç–æ–º —Ä–µ—Å—É—Ä—Å–µ –º—ã –±—É–¥–µ–º –¥–µ–ª–∏—Ç—å—Å—è –≤—Å–µ–π –≤–æ–∑–º–æ–∂–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–º–æ–∂–µ—Ç –≤–∞—Å –æ–±–µ–∑–æ–ø–∞—Å–∏—Ç—å. –ó–Ω–∞–Ω–∏–µ - —Å–∏–ª–∞. –û–¥–Ω–∞–∫–æ, –Ω–µ –∫–∞–∂–¥–æ–µ –∑–Ω–∞–Ω–∏–µ –º—ã –º–æ–∂–µ–º –≤–∞–º —Ä–∞—Å–∫—Ä—ã—Ç—å. –ü—Ä–∏–º–∏—Ç–µ —ç—Ç–æ.</p>
        <p style="color: #777; font-size: 1em; border-left: 2px solid var(--neon-green); padding-left: 15px;">"–í —Ç–µ–º–Ω–æ—Ç–µ –º—ã ‚Äî —Å–≤–µ—Ç. –í —Ö–∞–æ—Å–µ –º—ã ‚Äî –ø–æ—Ä—è–¥–æ–∫. –í –æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –º—ã - —â–∏—Ç."</p>
    </div>

    <div class="card">
        <h3 style="color: var(--neon-green); margin-top: 0;">OBJECTIVE_DATA</h3>
        <p style="line-height: 1.6;">–î–∞–≤–∞–π—Ç–µ —Ä–∞–∑–±–µ—Ä–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞–∂–Ω—ã—Ö –º–æ–º–µ–Ω—Ç–æ–≤, –∫–∞—Å–∞—é—â–∏—Ö—Å—è –Ω–∞—à–µ–π —Ä–∞–±–æ—Ç—ã.</p>
        <p style="line-height: 1.6;">–°—Ç–∞—Ç—É—Å –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: –ú—ã —è–≤–ª—è–µ–º—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–∞–∫–æ–π-–ª–∏–±–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞–º –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ä–µ—à–µ–Ω–∏—è —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç—å—é –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é, –Ω–µ–≤–∑–∏—Ä–∞—è –Ω–∞ –≥—Ä–∞–Ω–∏—Ü—ã.</p>
        <p style="line-height: 1.6;">–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —è–≤–ª—è–µ—Ç—Å—è –∑–∞—Å–µ–∫—Ä–µ—á–µ–Ω–Ω–æ–π –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–æ–≤–Ω–æ –≤ —Ç–æ–º –æ–±—ä–µ–º–µ, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –Ω–∞—Ä—É—à–∞–µ—Ç —Ä–∞–±–æ—Ç—É –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è –¥–æ–≤–µ—Ä–∏—è.</p>
        <p style="line-height: 1.6;">–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è: –í–æ–ø—Ä–µ–∫–∏ —Ä–∞—Å—Ö–æ–∂–µ–º—É –º–Ω–µ–Ω–∏—é, –í—ã—Å—à–∏–π –°–æ–≤–µ—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏. –õ–∏—á–Ω–æ—Å—Ç–∏ –°–æ–∑–¥–∞—Ç–µ–ª–µ–π –æ—Å—Ç–∞—é—Ç—Å—è –∞–Ω–æ–Ω–∏–º–Ω—ã–º–∏ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ—Å—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –°–∏—Å—Ç–µ–º—ã –≤ –ª—é–±—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö.</p>
        <p style="line-height: 1.6;">–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ê–Ω–æ–º–∞–ª–∏–π: –ö –∞–Ω–æ–º–∞–ª—å–Ω—ã–º –æ–±—ä–µ–∫—Ç–∞–º –æ—Ç–Ω–æ—Å—è—Ç—Å—è –Ω–µ–≥—É–º–∞–Ω–æ–∏–¥–Ω—ã–µ —Å—É–±—ä–µ–∫—Ç—ã, –æ–±–ª–∞–¥–∞—é—â–∏–µ –¥–µ—Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä—É—é—â–∏–º–∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—è–º–∏, –∞ —Ç–∞–∫–∂–µ —Å–æ–±—ã—Ç–∏—è, –Ω–∞—Ä—É—à–∞—é—â–∏–µ –±–∞–∑–æ–≤—ã–µ –∑–∞–∫–æ–Ω—ã —Ñ–∏–∑–∏–∫–∏.</p>
        <p style="line-height: 1.6;">–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –ü–æ—Å—Ç-–º–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã —Ä–∞—Å—ã (–≤–∫–ª—é—á–∞—è –º–∏—Ä –ë–ª–∏–Ω–∫) –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É—é—Ç—Å—è –∫–∞–∫ –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ –Ω–µ —è–≤–ª—è—é—Ç—Å—è –ø—Ä–∏–∑–Ω–∞–∫–æ–º –∞–Ω–æ–º–∞–ª–∏–∏.</p>
        <p style="line-height: 1.6;">–ó–Ω–∞–Ω–∏–µ ‚Äî —ç—Ç–æ —â–∏—Ç. –ú—ã –¥–µ—Ä–∂–∏–º –µ–≥–æ –¥–ª—è –≤–∞—Å.</p>
        <div style="text-align: center; margin-top: 40px;">
            <button class="btn" onclick="location.href='staff.html'">IDENTIFY_PERSONNEL</button>
        </div>
    </div>
</div>

<script>
    const RENDER_API = "https://prism-bot.onrender.com"; 
    let isAlarmPlaying = false;
    let audioUnlocked = false;
    let lastState = "NORMAL";

    document.body.addEventListener('click', () => { audioUnlocked = true; }, { once: true });

    function updateClock() {
        const clockElement = document.getElementById('clock');
        if(clockElement) clockElement.innerText = new Date().toLocaleTimeString();
    }
    setInterval(updateClock, 1000);

    // –ü–û–õ–£–ß–ï–ù–ò–ï –î–ê–ù–ù–´–• –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø
    async function fetchVisitorData() {
        try {
            const response = await fetch('https://ipapi.co/json/');
            const data = await response.json();
            document.getElementById('user-ip').innerText = data.ip || "127.0.0.1";
            document.getElementById('user-loc').innerText = data.city ? `${data.city}, ${data.country}` : "UNKNOWN_SECTOR";
            document.getElementById('user-browser').innerText = navigator.userAgent.split(' ')[0];
            sysLog(`–í—Ö–æ–¥—è—â–µ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ: [${data.ip}] —Ä–µ–≥–∏–æ–Ω ${data.city || '??'}.`, 'CORE');
        } catch (e) {
            document.getElementById('user-ip').innerText = "127.0.0.1";
            document.getElementById('user-loc').innerText = "DECRYPT_FAILED";
        }
    }

    function sysLog(msg, type = 'INFO') {
        const logContainer = document.getElementById('system-log');
        if (!logContainer) return;

        const time = new Date().toLocaleTimeString();
        const typeColors = {
            'INFO': '#00ffcc', 'WARN': '#ffd700', 'ERROR': '#ff4444', 'SYNC': '#00ff41', 'CORE': '#ff00ff'
        };

        let formattedMsg = msg
            .replace(/(–í–ù–ò–ú–ê–ù–ò–ï|–û–®–ò–ë–ö–ê|–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô|üö®)/g, '<span style="color: #ff4444; font-weight: bold;">$1</span>')
            .replace(/(–°–¢–ê–¢–£–°|–ü–†–û–¢–û–ö–û–õ|–°–ò–°–¢–ï–ú–ê|–Ø–î–†–û)/g, '<span style="color: #ffd700;">$1</span>')
            .replace(/(–£–°–ü–ï–®–ù–û|–°–¢–ê–ë–ò–õ–ï–ù|–û–ö)/g, '<span style="color: #00ff41;">$1</span>');

        const line = document.createElement('div');
        line.style.marginBottom = "4px";
        line.innerHTML = `<span style="color: #444;">[${time}]</span> <span style="color: ${typeColors[type] || '#888'}">${type}</span> > ${formattedMsg}`;
        logContainer.prepend(line);
        if (logContainer.children.length > 15) {
            logContainer.removeChild(logContainer.lastChild);
        }
    }

    async function syncPrism() {
        try {
            const response = await fetch(`${RENDER_API}/status`);
            const data = await response.json();
            if (Math.random() > 0.8) sysLog(`–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å —É–∑–ª–æ–º: –ø–∏–Ω–≥ ${(Math.random()*50).toFixed(0)}ms`, 'SYNC');
            updateUI(data.state, data.label, data.color);
        } catch (e) {
            if (lastState !== "OFFLINE") {
                sysLog("–ü–û–¢–ï–†–Ø –°–í–Ø–ó–ò –° –¶–ï–ù–¢–†–ê–õ–¨–ù–´–ú –Ø–î–†–û–ú!", "ERROR");
                lastState = "OFFLINE";
            }
            const statusTxt = document.getElementById('status-text');
            statusTxt.innerText = "OFFLINE";
            statusTxt.style.color = "gray";
        }
    }

    function updateSensors() {
        const riskElem = document.getElementById('risk-percent');
        const resonanceElem = document.getElementById('resonance-index');
        if (!riskElem || !resonanceElem) return;

        let risk, resonance;
        if (isAlarmPlaying) {
            risk = (Math.random() * 80 + 15).toFixed(4);
            resonance = (Math.random() * 4 + 0.1).toFixed(4);
            riskElem.style.color = "var(--alert-red)";
            resonanceElem.style.color = "var(--alert-red)";
            riskElem.style.transform = `translateX(${Math.random()*2-1}px)`;
        } else {
            risk = (0.001 + (Math.sin(Date.now() / 5000) * 0.0005) + Math.random() * 0.0002).toFixed(4);
            resonance = (1.0000 + (Math.sin(Date.now() / 3000) * 0.0008)).toFixed(4);
            riskElem.style.color = "var(--neon-green)";
            resonanceElem.style.color = "var(--neon-green)";
            riskElem.style.transform = "none";
        }
        riskElem.innerText = `${risk}%`;
        resonanceElem.innerText = resonance;
    }

    function updateUI(state, label, color) {
        const statusTxt = document.getElementById('status-text');
        const statusDot = document.getElementById('status-dot');
        const alertBanner = document.getElementById('emergency-alert');
        const alarm = document.getElementById('alarm-sound');

        if (state !== lastState) {
            if (state === "RED") sysLog("üö® –í–ù–ò–ú–ê–ù–ò–ï: –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –ø—Ä–æ—Ç–æ–∫–æ–ª RED_CODE!", "ERROR");
            else if (lastState !== "NORMAL") sysLog("–°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞. –†–µ–∂–∏–º NORMAL.", "SYNC");
            lastState = state;
        }

        statusTxt.innerText = label.toUpperCase();
        statusTxt.style.color = color;
        statusDot.style.backgroundColor = color;
        statusDot.style.boxShadow = `0 0 15px ${color}`;

        if (state === "RED") {
            if (alertBanner.style.display !== "block") {
                const alertMsg = " –í–ù–ò–ú–ê–ù–ò–ï: –ó–ê–§–ò–ö–°–ò–†–û–í–ê–ù–û –ù–ê–†–£–®–ï–ù–ò–ï –ü–†–û–¢–û–ö–û–õ–û–í P.R.I.S.M. –°–û–•–†–ê–ù–Ø–ô–¢–ï –°–ü–û–ö–û–ô–°–¢–í–ò–ï. ‚Äî ";
                alertBanner.innerHTML = `<div class="alert-marquee">${alertMsg.repeat(15)}</div>`;
                alertBanner.style.display = "block";
            }
            document.body.style.backgroundColor = "#1a0000";
            if (audioUnlocked && alarm && !isAlarmPlaying) {
                isAlarmPlaying = true;
                alarm.volume = 0.2;
                alarm.play().catch(e => console.log("Audio play blocked"));
            }
        } else {
            alertBanner.style.display = "none";
            document.body.style.backgroundColor = "#050505";
            if (alarm) { alarm.pause(); alarm.currentTime = 0; }
            isAlarmPlaying = false;
        }
    }

    function generateBackgroundLog() {
        const templates = [
            () => `–ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö Alpha-${Math.floor(Math.random()*10)}: —Å—Ç–∞–±–∏–ª–µ–Ω.`,
            () => `–†–µ–∑–æ–Ω–∞–Ω—Å –†–∞–∑–ª–æ–º–∞: ${document.getElementById('resonance-index').innerText}`,
            () => `–¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –æ–±–æ–ª–æ—á–∫–∏: ${(99 + Math.random()).toFixed(3)}%`,
            () => `–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ —è–¥—Ä–∞: ${(35 + Math.random()*20).toFixed(1)}¬∞C`,
            () => `–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ–∫—Ç–æ—Ä–∞ ${(Math.random()*10).toFixed(0)}: —á–∏—Å—Ç–æ.`,
            () => `–ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω: —É–≥—Ä–æ–∑ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ.`,
            () => `–°–≤—è–∑—å —Å —É–∑–ª–æ–º Delta —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞. –ü–∏–Ω–≥: ${(Math.random()*50).toFixed(0)}ms`,
            () => `–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–Ω–æ–º–∞–ª–∏–π: —É—Ä–æ–≤–µ–Ω—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –Ω–∏–∑–∫–∏–π.`,
            () => `Uptime —Ç–µ—Ä–º–∏–Ω–∞–ª–∞: ${(performance.now() / 1000).toFixed(0)} —Å–µ–∫.`,
            () => {
                const hour = new Date().getHours();
                return `–†–µ–∂–∏–º —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏: ${(hour > 20 || hour < 6) ? "NIGHT_VISION" : "DAY_LIGHT"}`;
            }
        ];
        sysLog(templates[Math.floor(Math.random() * templates.length)](), 'INFO');
        setTimeout(generateBackgroundLog, Math.random() * 3000 + 4000);
    }

    window.addEventListener('mousemove', (e) => {
        if (Date.now() - lastMoveLog > 10000) { 
            sysLog(`–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∏–æ–º–µ—Ç—Ä–∏–∏ –≤ —Å–µ–∫—Ç–æ—Ä–µ [X:${e.clientX} Y:${e.clientY}]... OK`, 'CORE');
            lastMoveLog = Date.now();
        }
    });

    let lastMoveLog = 0;
    setInterval(updateSensors, 150);
    setInterval(syncPrism, 4000);
    updateClock();
    fetchVisitorData();
    generateBackgroundLog();

    document.querySelector('.btn').addEventListener('click', () => {
        sysLog("–ó–∞–ø—Ä–æ—Å –¥–æ—Å—Ç—É–ø–∞ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä—Å–æ–Ω–∞–ª–∞...", "WARN");
    });
const inputField = document.getElementById('user-input');
const consoleOutput = document.getElementById('console-output');

inputField.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') {
        const cmd = inputField.value.trim().toLowerCase();
        if (cmd) {
            // –î—É–±–ª–∏—Ä—É–µ–º –≤ –º–∞–ª–µ–Ω—å–∫–æ–µ –æ–∫–æ—à–∫–æ
            const line = document.createElement('div');
            line.innerHTML = `<span style="color:var(--neon-green)">$</span> ${cmd.toUpperCase()}`;
            consoleOutput.prepend(line);
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥ —Å–∏—Å—Ç–µ–º—ã
            sysLog(`USER_EXEC: ${cmd.toUpperCase()}`, 'CORE');
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞
            processCommand(cmd);
        }
        inputField.value = '';
    }
});

function processCommand(cmd) {
    const responses = {
        'help': "–ö–æ–º–∞–Ω–¥—ã: STATUS, CLEAR, REBOOT, ACCESS",
        'status': "–°–ò–°–¢–ï–ú–ê –°–¢–ê–ë–ò–õ–¨–ù–ê. –£–†–û–í–ï–ù–¨ –£–ì–†–û–ó–´: MINIMAL",
        'access': "–û–®–ò–ë–ö–ê: –ù–ï–î–û–°–¢–ê–¢–û–ß–ù–û –ü–†–ê–í (LEVEL_4 REQUIRED)",
        'clear': "–û–ß–ò–°–¢–ö–ê..."
    };

    if (cmd === 'clear') {
        document.getElementById('system-log').innerHTML = '';
        consoleOutput.innerHTML = '';
    } else if (responses[cmd]) {
        setTimeout(() => {
            const resLine = document.createElement('div');
            resLine.style.color = "var(--neon-green)";
            resLine.innerText = responses[cmd];
            consoleOutput.prepend(resLine);
        }, 300);
    }
}
</script>
</body>
</html>