<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>P.R.I.S.M. | Terminal</title>
    <style>
    :root { 
        --neon-green: #00ffcc; 
        --alert-red: #ff4444; 
        --bg-dark: #050505; 
        --panel-bg: rgba(10, 15, 15, 0.9); 
        --border-color: #1a3a3a;
    }

    body { 
        background: var(--bg-dark); 
        color: #d1d1d1; 
        font-family: 'Courier New', monospace; 
        margin: 0; padding-bottom: 40px;
        font-size: 14px;
    }

    body::before {
        content: ""; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background-image: linear-gradient(var(--border-color) 1px, transparent 1px), linear-gradient(90deg, var(--border-color) 1px, transparent 1px);
        background-size: 40px 40px; opacity: 0.05; z-index: -1;
    }

    .container { max-width: 1000px; margin: 20px auto; padding: 0 20px; }

    .main-header {
        text-align: center; padding: 20px; border: 1px solid var(--border-color);
        background: linear-gradient(180deg, rgba(0, 255, 204, 0.03) 0%, transparent 100%);
        margin-bottom: 20px;
    }

    .card { 
        background: var(--panel-bg); border: 1px solid var(--border-color); 
        padding: 20px; margin-bottom: 20px; position: relative;
    }
    
    .card::before { content: ""; position: absolute; top: -1px; left: -1px; width: 10px; height: 10px; border-top: 2px solid var(--neon-green); border-left: 2px solid var(--neon-green); }
    .card::after { content: ""; position: absolute; bottom: -1px; right: -1px; width: 10px; height: 10px; border-bottom: 2px solid var(--neon-green); border-right: 2px solid var(--neon-green); }

    .status-bar {
        border: 1px solid var(--border-color); padding: 15px 20px; 
        display: flex; justify-content: space-between; align-items: center;
        background: rgba(0, 255, 204, 0.02); margin-bottom: 20px;
    }

    .dot { width: 10px; height: 10px; background: var(--neon-green); box-shadow: 0 0 10px var(--neon-green); animation: pulse 1.5s infinite; }

    .btn {
        background: rgba(0, 255, 204, 0.05); border: 1px solid var(--neon-green);
        color: var(--neon-green); padding: 10px 25px; cursor: pointer;
        text-transform: uppercase; font-size: 0.8em; transition: 0.3s;
    }
    .btn:hover { background: var(--neon-green); color: #000; box-shadow: 0 0 15px var(--neon-green); }

    #system-log { height: 120px; overflow-y: auto; font-size: 0.85em; color: #008877; scrollbar-width: none; }
    #mini-console-output { height: 50px; overflow: hidden; font-size: 0.8em; display: flex; flex-direction: column-reverse; color: #666; }

    @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }
    
    input { background: transparent; border: none; color: #fff; outline: none; font-family: inherit; width: 100%; }
    
    .counter-num { font-size: 2.2em; color: var(--neon-green); font-weight: bold; }
    
    nav { background: #000; padding: 15px; border-bottom: 1px solid var(--border-color); text-align: center; }
    nav a { color: #444; text-decoration: none; padding: 0 15px; font-size: 0.8em; letter-spacing: 1px; }
    nav a:hover { color: var(--neon-green); }

    #emergency-alert { display: none; position: fixed; bottom: 0; width: 100%; background: var(--alert-red); color: #000; padding: 10px; z-index: 9999; font-weight: bold; text-align: center; }
    </style>
</head>
<body>

<nav>
    <a href="#" style="color: var(--neon-green);">[ MAIN ]</a>
    <a href="#">ARCHIVE</a>
    <a href="#">DOSSIER</a>
    <a href="#">TERMINAL</a>
</nav>

<div id="emergency-alert">SYSTEM CRITICAL ERROR - DATA BREACH DETECTED</div>

<div class="container">
    <div class="main-header">
        <h2 style="letter-spacing: 10px; color: var(--neon-green); margin: 0;">P.R.I.S.M.</h2>
    </div>

    <div class="status-bar">
        <div style="display: flex; align-items: center; gap: 15px;">
            <div class="dot" id="status-dot"></div>
            <div>
                <div style="font-size: 0.6em; color: #555;">SYSTEM_INTEGRITY</div>
                <div id="status-text" style="font-weight: bold; color: var(--neon-green);">CONNECTING...</div>
            </div>
        </div>
        <div style="text-align: right;">
            <div style="font-size: 0.6em; color: #555;">SERVER_TIME</div>
            <div id="clock" style="color: var(--neon-green);">00:00:00</div>
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
        <div class="card">
            <div style="font-size: 0.6em; color: #444; margin-bottom: 10px;">CONNECTION_METRICS</div>
            <div id="user-info" style="font-size: 0.85em; line-height: 1.6;">
                <div>IP: <span id="user-ip" style="color: var(--neon-green);">127.0.0.1</span></div>
                <div>LOC: <span id="user-loc" style="color: var(--neon-green);">SCANNING...</span></div>
                <div>SEC: <span style="color: var(--neon-green);">ENCRYPTED</span></div>
            </div>
        </div>

        <div class="card" style="background: rgba(0,0,0,0.5);">
            <div style="font-size: 0.6em; color: #444; margin-bottom: 10px;">USER_CONSOLE</div>
            <div id="mini-console-output"><div>Waiting for input...</div></div>
            <div style="display: flex; border-top: 1px solid #1a1a1a; padding-top: 8px; margin-top: 5px;">
                <span style="color: var(--neon-green); margin-right: 5px;">></span>
                <input type="text" id="user-input" placeholder="Type command..." autofocus>
            </div>
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
        <div class="card" style="text-align: center;">
            <div style="font-size: 0.6em; color: #444;">COLLAPSE_RISK</div>
            <div class="counter-num" id="risk-percent">0.0000%</div>
        </div>
        <div class="card" style="text-align: center;">
            <div style="font-size: 0.6em; color: #444;">RESONANCE_ID</div>
            <div class="counter-num" id="resonance-index">1.0000</div>
        </div>
    </div>

    <div class="card" style="background: #000;">
        <div style="font-size: 0.6em; color: #444; border-bottom: 1px solid #111; padding-bottom: 5px; margin-bottom: 10px;">LIVE_SYSTEM_FEED</div>
        <div id="system-log"></div>
    </div>

    <div class="card" style="margin-top: 20px;">
        <div style="font-size: 0.6em; color: #444; border-bottom: 1px solid #111; padding-bottom: 5px; margin-bottom: 15px;">ARCHIVE_ENTRY_#042</div>
        <h3 style="color: var(--neon-green); margin-top: 0; letter-spacing: 2px;">OBJECTIVE_DATA</h3>
        
        <div style="max-width: 800px; margin: 0 auto; color: #aaa;">
            <p style="line-height: 1.6; border-left: 2px solid var(--neon-green); padding-left: 15px; margin-bottom: 20px;">
                <strong style="color: #fff;">Статус независимости:</strong> Мы являемся независимой структурой. Отсутствие какой-либо зависимости позволяет нам принимать решения с максимальной скоростью и эффективностью, невзирая на границы.
            </p>
            <p style="line-height: 1.6; border-left: 2px solid #333; padding-left: 15px; margin-bottom: 20px;">
                <strong style="color: #fff;">Политика конфиденциальности:</strong> Информация о деятельности организации является засекреченной и предоставляется общественности ровно в том объеме, который необходим для поддержания доверия.
            </p>
            <p style="line-height: 1.6; border-left: 2px solid #333; padding-left: 15px; margin-bottom: 20px;">
                <strong style="color: #fff;">Структура управления:</strong> Высший Совет выполняет исполнительные функции. Личности Создателей анонимны для обеспечения непрерывности функционирования Системы.
            </p>
            <p style="line-height: 1.6; border-left: 2px solid #333; padding-left: 15px; margin-bottom: 20px;">
                <strong style="color: #fff;">Определение Аномалий:</strong> К аномальным объектам относятся негуманоидные субъекты и события, нарушающие базовые законы физики. 
                <span style="color: #666; font-style: italic;">Примечание: Пост-миграционные модификаторы (мир Блинк) классифицируются как адаптивные изменения.</span>
            </p>
            <p style="text-align: center; color: var(--neon-green); font-weight: bold; margin-top: 30px; letter-spacing: 3px;">
                ЗНАНИЕ — ЭТО ЩИТ. МЫ ДЕРЖИМ ЕГО ДЛЯ ВАС.
            </p>
        </div>

        <div style="text-align: center; margin-top: 30px; border-top: 1px dashed var(--border-color); padding-top: 20px;">
            <button class="btn" onclick="location.href='staff.html'">IDENTIFY_PERSONNEL</button>
        </div>
    </div> 
    <script>
    const RENDER_API = "https://prism-bot.onrender.com";
    let lastState = "NORMAL";
    
    // 1. Часы
    setInterval(() => {
        const clockElem = document.getElementById('clock');
        if(clockElem) clockElem.innerText = new Date().toLocaleTimeString();
    }, 1000);

    // 2. Логирование
    function sysLog(msg, type = 'INFO') {
        const log = document.getElementById('system-log');
        if(!log) return;
        const colors = { 'INFO': '#00ffcc', 'WARN': '#ffd700', 'ERROR': '#ff4444', 'CORE': '#ff00ff' };
        const line = document.createElement('div');
        line.innerHTML = `<span style="color: #333;">[${new Date().toLocaleTimeString()}]</span> <span style="color: ${colors[type]}">${type}</span> > ${msg}`;
        log.prepend(line);
        if (log.children.length > 12) log.removeChild(log.lastChild);
    }

    // 3. Данные пользователя
    async function fetchVisitorData() {
        try {
            const res = await fetch('https://ipapi.co/json/');
            const data = await res.json();
            document.getElementById('user-ip').innerText = data.ip || "127.0.0.1";
            document.getElementById('user-loc').innerText = `${data.city || 'Unknown'}, ${data.country_code || '??'}`;
            sysLog("User biometrics synchronized.", "CORE");
        } catch (e) {
            document.getElementById('user-ip').innerText = "LOCAL_HOST";
            document.getElementById('user-loc').innerText = "PROXY_HIDDEN";
        }
    }

    // 4. Синхронизация с API
    async function syncPrism() {
        const statusTxt = document.getElementById('status-text');
        const controller = new AbortController();
        const id = setTimeout(() => controller.abort(), 5000);

        try {
            const response = await fetch(`${RENDER_API}/status`, { signal: controller.signal });
            const data = await response.json();
            clearTimeout(id);
            updateUI(data.state, data.label, data.color);
        } catch (e) {
            if (statusTxt && statusTxt.innerText === "CONNECTING...") {
                updateUI("NORMAL", "LOCAL_ACTIVE", "#00ffcc");
                sysLog("Central node unreachable. Running on local buffer.", "WARN");
            }
        }
    }

    function updateUI(state, label, color) {
        const statusTxt = document.getElementById('status-text');
        const statusDot = document.getElementById('status-dot');
        if(statusTxt) {
            statusTxt.innerText = label.toUpperCase();
            statusTxt.style.color = color;
        }
        if(statusDot) {
            statusDot.style.backgroundColor = color;
            statusDot.style.boxShadow = `0 0 10px ${color}`;
        }
        
        const alertBanner = document.getElementById('emergency-alert');
        if (state === "RED") {
            if(alertBanner) alertBanner.style.display = "block";
            document.body.style.backgroundColor = "#100";
        } else {
            if(alertBanner) alertBanner.style.display = "none";
            document.body.style.backgroundColor = "#050505";
        }
    }

    // 5. Консоль
    const input = document.getElementById('user-input');
    const miniOut = document.getElementById('mini-console-output');

    if(input) {
        input.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                const val = input.value.trim().toLowerCase();
                if (val) {
                    const l = document.createElement('div');
                    l.innerHTML = `<span style="color: var(--neon-green)">></span> ${val.toUpperCase()}`;
                    if(miniOut) miniOut.prepend(l);
                    executeCmd(val);
                }
                input.value = '';
            }
        });
    }

    function executeCmd(cmd) {
        sysLog(`Exec: ${cmd.toUpperCase()}`, "CORE");
        if (cmd === 'help') sysLog("Commands: status, clear, reboot", "INFO");
        else if (cmd === 'clear') { 
            const log = document.getElementById('system-log');
            if(log) log.innerHTML = ''; 
            if(miniOut) miniOut.innerHTML = ''; 
        }
        else if (cmd === 'reboot') { sysLog("Rebooting terminal...", "ERROR"); setTimeout(() => location.reload(), 1000); }
        else if (cmd === 'status') sysLog("All systems nominal. Encryption: AES-256.", "INFO");
    }

    // 6. Сенсоры и фоновые фразы
    function generateBackgroundLog() {
        const templates = [
            () => `Поток данных Alpha-${Math.floor(Math.random()*10)}: СТАБИЛЕН.`,
            () => `Резонанс Разлома: ${document.getElementById('resonance-index').innerText}`,
            () => `Целостность оболочки: ${(99 + Math.random()).toFixed(3)}%`,
            () => `Температура ядра: ${(35 + Math.random()*20).toFixed(1)}°C`,
            () => `Сканирование сектора ${(Math.random()*100).toFixed(0)}: УГРОЗ НЕ ОБНАРУЖЕНО.`,
            () => `Анализ входящих пакетов... OK.`,
            () => `Связь с узлом Delta установлена. Пинг: ${(Math.random()*50).toFixed(0)}ms`,
            () => `Мониторинг аномалий: Уровень активности МИНИМАЛЬНЫЙ.`,
            () => `Uptime терминала: ${(performance.now() / 1000).toFixed(0)} сек.`,
            () => {
                const hour = new Date().getHours();
                const mode = (hour > 20 || hour < 6) ? "NIGHT_VISION" : "DAY_LIGHT";
                return `Режим фильтрации: ${mode}.`;
            },
            () => `Использование памяти ядра: ${(Math.random() * 40 + 10).toFixed(2)} MB / 256 MB`,
            () => `Активная зона захвата: ${window.innerWidth}x${window.innerHeight}`,
            () => `Протокол синхронизации P.R.I.S.M. v2.0.26 активен.`,
            () => `Обнаружен физический контакт с интерфейсом.`,
            () => `Калибровка датчиков: Ошибка 0.000${Math.floor(Math.random()*9)}%`
        ];

        const randomMsg = templates[Math.floor(Math.random() * templates.length)]();
        sysLog(randomMsg, 'INFO');
        setTimeout(generateBackgroundLog, Math.random() * 4000 + 4000);
    }

    // Движение мыши
    let lastMoveLog = 0;
    window.addEventListener('mousemove', (e) => {
        let now = Date.now();
        if (now - lastMoveLog > 15000) { 
            sysLog(`Сканирование биометрии [X:${e.clientX} Y:${e.clientY}]... OK`, 'CORE');
            lastMoveLog = now;
        }
    });

    // Запуск всех систем
    fetchVisitorData();
    generateBackgroundLog();
    setInterval(syncPrism, 5000);
    setInterval(() => {
        const riskElem = document.getElementById('risk-percent');
        const resElem = document.getElementById('resonance-index');
        if(riskElem) riskElem.innerText = (0.001 + Math.random() * 0.005).toFixed(4) + "%";
        if(resElem) resElem.innerText = (1.0000 + Math.sin(Date.now()/2000)*0.001).toFixed(4);
    }, 200);

    sysLog("P.R.I.S.M. Terminal v2.0 initialized.", "INFO");
    setTimeout(syncPrism, 1000);
</script>
</body>
</html>

