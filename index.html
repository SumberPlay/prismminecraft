<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>P.R.I.S.M. | Control Terminal</title>
    <style>
        :root { 
            --neon-green: #00ffcc; 
            --alert-red: #ff4444; 
            --bg-dark: #050505; 
            --panel-bg: #111; 
        }
        body { 
            background: var(--bg-dark); 
            color: #d1d1d1; 
            font-family: 'Courier New', monospace; 
            margin: 0; 
            overflow: hidden;
            transition: background-color 0.8s;
        }

        /* Сканирующая линия (эффект терминала) */
        body::after {
            content: " ";
            position: fixed; top: 0; left: 0; width: 100%; height: 2px;
            background: rgba(0, 255, 204, 0.1);
            z-index: 9999; pointer-events: none;
            animation: scanline 8s linear infinite;
        }
        @keyframes scanline { 0% { top: -10%; } 100% { top: 110%; } }

        nav { background: #000; padding: 15px; border-bottom: 1px solid #333; text-align: center; }
        nav a { color: #888; text-decoration: none; text-transform: uppercase; padding: 0 20px; transition: 0.3s; }
        nav a:hover { color: var(--neon-green); text-shadow: 0 0 8px var(--neon-green); }

        .container { max-width: 900px; margin: 40px auto; padding: 0 20px; }
        
        .status-bar {
            border: 1px solid #333; padding: 25px; display: flex; 
            justify-content: space-between; align-items: center;
            background: rgba(10, 26, 26, 0.8);
            position: relative;
        }

        .dot {
            width: 15px; height: 15px; border-radius: 50%;
            background: var(--neon-green);
            box-shadow: 0 0 15px var(--neon-green);
            display: inline-block; margin-right: 10px;
        }

        #emergency-alert {
            display: none;
            position: fixed; top: 0; left: 0; width: 100%;
            background: var(--alert-red); color: #000;
            padding: 10px; text-align: center; font-weight: bold;
            z-index: 2000; animation: blink 1s infinite;
        }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        .card { background: var(--panel-bg); border: 1px solid #222; padding: 30px; margin-top: 20px; text-align: center; }
        
        #status-text { font-size: 1.5em; font-weight: bold; letter-spacing: 2px; }

        .btn {
            background: transparent; border: 1px solid var(--neon-green);
            color: var(--neon-green); padding: 12px 30px; cursor: pointer;
            text-transform: uppercase; font-weight: bold; transition: 0.3s; margin-top: 20px;
        }
        .btn:hover { background: var(--neon-green); color: #000; box-shadow: 0 0 20px var(--neon-green); }
        
        .hint { font-size: 0.7em; color: #444; margin-top: 10px; }
    </style>
</head>
<body onclick="enableAudio()"> <div id="emergency-alert">КРИТИЧЕСКАЯ ОШИБКА: НАРУШЕНИЕ УСЛОВИЙ СОДЕРЖАНИЯ!</div>

<nav>
    <a href="#">ГЛАВНАЯ</a>
    <a href="staff.html">ТЕРМИНАЛ</a>
</nav>

<div class="container">
    <div style="text-align: center; margin-bottom: 30px;">
        <h1 style="letter-spacing: 10px; color: var(--neon-green);">P.R.I.S.M.</h1>
    </div>

    <div class="status-bar">
        <div>
            <div id="status-dot" class="dot"></div>
            <span id="status-text">INITIALIZING...</span>
        </div>
        <div style="text-align: right;">
            <div style="font-size: 0.8em; color: #555;">SYSTEM TIME</div>
            <div id="clock">00:00:00</div>
        </div>
    </div>

    <div class="card">
        <h3>ОПЕРАТИВНАЯ СВОДКА</h3>
        <p id="description">Ожидание синхронизации с базой данных P.R.I.S.M...</p>
        <div class="hint">Нажмите в любом месте страницы, чтобы активировать аудио-систему</div>
    </div>
</div>

<audio id="alarm-sound" loop>
    <source src="alarm.mp3" type="audio/mpeg">
</audio>

<script>
    // !!! ВСТАВЬ СЮДА СВОЮ ССЫЛКУ ИЗ APPS SCRIPT (ПОСЛЕ НОВОГО ДЕПЛОЯ) !!!
    const API_URL = "https://script.google.com/macros/s/AKfycbyzFzJjDFxTHFHXYqlYrov6NQfPqKfnM6zppNDyzRWguFH6b43n0upA93ClXURvOclZXQ/exec";

    let isAlarmPlaying = false;
    let audioUnlocked = false;

    // Разблокировка аудио (нужна из-за политики браузеров)
    function enableAudio() {
        audioUnlocked = true;
        console.log("Audio system activated");
    }

    async function syncPrism() {
        try {
            const response = await fetch(API_URL);
            if (!response.ok) throw new Error("API Offline");
            
            const data = await response.json();
            updateUI(data.state, data.label, data.color);

        } catch (error) {
            console.error("Sync Error:", error);
            document.getElementById('status-text').innerText = "SYSTEM OFFLINE";
            document.getElementById('status-text').style.color = "gray";
        }
    }

    function updateUI(state, label, color) {
        const txt = document.getElementById('status-text');
        const dot = document.getElementById('status-dot');
        const alert = document.getElementById('emergency-alert');
        const alarm = document.getElementById('alarm-sound');

        txt.innerText = label.toUpperCase();
        txt.style.color = color;
        dot.style.backgroundColor = color;
        dot.style.boxShadow = `0 0 15px ${color}`;

        if (state === "RED") {
            alert.style.display = "block";
            document.body.style.backgroundColor = "#1a0000";
            if (audioUnlocked && !isAlarmPlaying) {
                alarm.play().catch(e => console.log("Audio play blocked"));
                isAlarmPlaying = true;
            }
        } else {
            alert.style.display = "none";
            document.body.style.backgroundColor = "#050505";
            alarm.pause();
            alarm.currentTime = 0;
            isAlarmPlaying = false;
        }
    }

    // Часы и интервалы
    setInterval(() => {
        document.getElementById('clock').innerText = new Date().toLocaleTimeString();
    }, 1000);

    setInterval(syncPrism, 3000);
    syncPrism();
</script>
</body>
</html>
