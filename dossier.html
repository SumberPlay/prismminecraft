const RENDER_URL = "https://prism-bot.onrender.com";

// Новая функция входа через API
async function startAuthProcess(type) {
    if (type === 'guest') {
        localStorage.setItem('prism_level', 1);
        localStorage.setItem('prism_user', 'ГОСТЬ');
        location.reload();
        return;
    }

    const uid = document.getElementById('uid').value;
    const ups = document.getElementById('ups').value;
    const passwordMD5 = CryptoJS.MD5(ups).toString();

    const res = await fetch(`${RENDER_URL}/api/login`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ uid, passwordMD5 })
    });
    const data = await res.json();

    if (data.success) {
        localStorage.setItem('prism_level', data.level);
        localStorage.setItem('prism_user', data.name);
        location.reload();
    } else {
        alert("ОТКАЗАНО: Неверный ID или пароль");
    }
}

// Загрузка всех сотрудников из бота
async function loadExternalPlayers(userLevel) {
    const container = document.getElementById('dossier-container');
    container.innerHTML = ''; // Очищаем перед загрузкой
    
    const response = await fetch(`${RENDER_URL}/get-external-staff`);
    const players = await response.json();

    players.forEach(p => {
        const isLocked = userLevel < p.level;
        const card = document.createElement('div');
        card.className = 'player-card';
        card.innerHTML = `
            <div class="lock-text" style="${isLocked ? 'display:flex' : 'none'}">LEVEL ${p.level} REQUIRED</div>
            <div class="content-wrap ${isLocked ? 'locked' : ''}" style="display:flex; width:100%;">
                <img src="https://minotar.net/armor/bust/${p.skin}/100.png" class="photo">
                <div class="info">
                    <div class="name">${p.name}</div>
                    <div class="status status-active">СТАТУС: В СЕТИ</div>
                    <div class="bio">${p.bio}</div>
                </div>
            </div>`;
        container.appendChild(card);
    });
}
