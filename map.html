<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>P.R.I.S.M. | TACTICAL_MONITORING</title>
    <style>
    :root { 
        --neon: #00ffcc; 
        --alert: #ff4444; 
        --bg: #050505; 
        --dim: #004433;
    }

    * { box-sizing: border-box; }

    body { 
        background: var(--bg); color: var(--neon); 
        font-family: 'Courier New', monospace; 
        margin: 0; padding: 0; overflow: hidden;
        text-transform: uppercase; font-size: 13px;
    }

    /* Эффект ЭЛТ-монитора */
    .crt-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: repeating-linear-gradient(0deg, rgba(0,0,0,0.05) 0px, transparent 2px);
        pointer-events: none; z-index: 1000;
    }

    .app-grid {
        display: grid;
        grid-template-columns: 280px 1fr 340px;
        grid-template-rows: 50px 1fr 180px;
        height: 100vh; gap: 10px; padding: 10px;
    }

    .window { border: 1px solid var(--neon); background: #000; display: flex; flex-direction: column; position: relative; }
    .win-header { background: var(--neon); color: #000; padding: 4px 10px; font-weight: bold; font-size: 0.85em; display: flex; justify-content: space-between; align-items: center; }

    .header { grid-column: 1 / 4; display: flex; align-items: center; justify-content: space-between; padding: 0 15px; border: 1px solid var(--neon); }
    .nav-links a { color: var(--neon); text-decoration: none; margin-left: 20px; font-weight: bold; border: 1px solid transparent; padding: 2px 5px; }
    .nav-links a:hover { border-color: var(--neon); }

    /* --- ТАКТИЧЕСКАЯ КАРТА --- */
    .map-area { 
        grid-column: 2; grid-row: 2; 
        overflow: hidden; position: relative; 
        cursor: crosshair;
        background: 
            radial-gradient(circle at center, #001100 0%, #000 90%),
            linear-gradient(var(--dim) 1px, transparent 1px) 0 0 / 40px 40px,
            linear-gradient(90deg, var(--dim) 1px, transparent 1px) 0 0 / 40px 40px;
    }

    #map-svg {
        position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        pointer-events: none; z-index: 2;
    }

    .node-link {
        stroke: var(--dim); stroke-width: 1; stroke-dasharray: 4;
        transition: 0.5s;
    }

    /* ИСПРАВЛЕННЫЙ РАДАР */
    .radar-sweep {
        position: absolute; 
        top: 50%; left: 50%; 
        width: 1000px; height: 1000px; /* Большой охват */
        background: conic-gradient(from 0deg, rgba(0, 255, 204, 0.25) 0deg, transparent 90deg);
        transform-origin: center center;
        transform: translate(-50%, -50%) rotate(0deg);
        animation: sweep 4s linear infinite; 
        pointer-events: none;
        z-index: 1;
    }

    @keyframes sweep { 
        from { transform: translate(-50%, -50%) rotate(0deg); } 
        to { transform: translate(-50%, -50%) rotate(360deg); } 
    }

    .radar-circle {
        position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
        border: 1px solid var(--dim); border-radius: 50%; pointer-events: none; z-index: 0;
    }

    .circle-pulse {
        animation: radar-pulse 4s infinite linear; opacity: 0;
    }

    @keyframes radar-pulse {
        0% { width: 0; height: 0; opacity: 0.5; }
        100% { width: 900px; height: 900px; opacity: 0; }
    }

    /* --- ОБЪЕКТЫ НА КАРТЕ --- */
    .point { 
        position: absolute; width: 14px; height: 14px; 
        border: 1px solid var(--neon); cursor: pointer; z-index: 10;
        transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
        background: rgba(0,0,0,0.9);
        transform: translate(-50%, -50%);
    }
    .point:hover { background: var(--neon); box-shadow: 0 0 15px var(--neon); transform: translate(-50%, -50%) scale(1.3); }
    .point.selected { border-width: 3px; background: #fff; box-shadow: 0 0 20px #fff; }
    .point.offline { border-color: #444; color: #444; }

    /* --- ПАНЕЛИ --- */
    #activity-graph {
        position: absolute; bottom: 15px; left: 15px; width: 240px; height: 70px;
        border-left: 1px solid var(--dim); border-bottom: 1px solid var(--dim);
        background: rgba(0,0,0,0.6); z-index: 5;
    }

    .coords-overlay {
        position: absolute; bottom: 10px; right: 10px;
        font-size: 0.7em; color: var(--dim); pointer-events: none;
    }

    .sidebar-left, .sidebar-right { overflow-y: auto; background: rgba(0,0,0,0.8); }
    .bottom-log { grid-column: 2; grid-row: 3; }

    .cmd-btn {
        background: transparent; border: 1px solid var(--neon); color: var(--neon);
        padding: 10px; margin: 5px 0; cursor: pointer; text-align: left;
        font-family: inherit; font-size: 0.8em; transition: 0.2s; width: 100%;
    }
    .cmd-btn:hover { background: var(--neon); color: #000; box-shadow: 0 0 10px var(--neon); }

    .stat-row { padding: 10px; display: flex; justify-content: space-between; border-bottom: 1px solid #111; }

    /* ТЕРМИНАЛ ВЗЛОМА */
    #shell-overlay {
        display: none; position: fixed; inset: 0; 
        background: rgba(0,0,0,0.98); z-index: 2000; padding: 40px;
    }

    #log-stream { padding: 12px; font-size: 0.8em; color: #008877; line-height: 1.5; overflow-y: auto; height: 100%; }
    .log-line { border-left: 2px solid var(--dim); padding-left: 10px; margin-bottom: 4px; }
    </style>
</head>
<body>

<div class="crt-overlay"></div>

<div id="shell-overlay">
    <div class="window" style="height: 100%;">
        <div class="win-header">
            <span>TERMINAL_ACCESS_GRANTED</span>
            <span onclick="closeShell()" style="cursor:pointer; padding: 0 10px; background: var(--alert); color: #000;">[TERMINATE]</span>
        </div>
        <div id="shell-output" style="padding: 25px; color: var(--neon); font-size: 1.3em; overflow-y: auto; height: 100%; white-space: pre-wrap; font-weight: bold;"></div>
    </div>
</div>

<div class="app-grid">
    <header class="header">
        <div style="letter-spacing: 2px;">[ P.R.I.S.M. INTEL_LINK v4.5 ]</div>
        <div id="sys-clock" style="font-weight: bold;">00:00:00</div>
        <nav class="nav-links">
            <a href="index.html">/ROOT</a>
            <a href="staff.html">/STAFF</a>
        </nav>
    </header>

    <aside class="window sidebar-left">
        <div class="win-header"><span>SYSTEM_INTEGRITY</span></div>
        <div class="stat-row"><span>CPU_LOAD</span><span id="cpu-load">--%</span></div>
        <div class="stat-row"><span>LINK_QUALITY</span><span id="net-status">SCANNING</span></div>
        <div class="stat-row"><span>ENTROPY_LVL</span><span id="entropy-val">0.0000</span></div>
        <div style="padding: 15px;">
            <div style="font-size: 0.7em; margin-bottom: 8px; color: var(--dim);">// QUICK_PROTOCOLS:</div>
            <button class="cmd-btn" onclick="scanSectors()">RE-SCAN ALL SECTORS</button>
            <button class="cmd-btn" onclick="location.reload()">REBOOT INTERFACE</button>
        </div>
    </aside>

    <section class="window map-area" id="map-container" onmousemove="updateCoords(event)">
        <div class="win-header">
            <span>LIVE_RADAR_FEED</span>
            <span id="coord-display" style="font-family: monospace; letter-spacing: 1px;">X:000 Y:000</span>
        </div>
        
        <svg id="map-svg">
            <line x1="35%" y1="25%" x2="50%" y2="35%" class="node-link" />
            <line x1="20%" y1="65%" x2="50%" y2="35%" class="node-link" />
            <line x1="50%" y1="35%" x2="72%" y2="48%" class="node-link" id="link-v3" />
        </svg>

        <div class="radar-circle" style="width:200px; height:200px; opacity:0.4"></div>
        <div class="radar-circle" style="width:400px; height:400px; opacity:0.2"></div>
        <div class="radar-circle" style="width:600px; height:600px; opacity:0.1"></div>
        <div class="radar-circle circle-pulse"></div>
        
        <div class="radar-sweep"></div>
        
        <div class="point offline" style="top:25%; left:35%;" onclick="selectNode('v1')" title="ALPHA-M V1"></div>
        <div class="point offline" style="top:65%; left:20%;" onclick="selectNode('v2')" title="ALPHA-M V2"></div>
        <div class="point offline" style="top:35%; left:50%;" onclick="selectNode('v22')" title="ALPHA-M V2.2"></div>
        <div class="point" id="v3-node" style="top:48%; left:72%;" onclick="selectNode('v3')" title="ALPHA-M V3"></div>

        <canvas id="activity-graph"></canvas>
        <div class="coords-overlay">LOCAL_GRID: BLINK_BASE_MC</div>
    </section>

    <aside class="window sidebar-right">
        <div class="win-header"><span>NODE_INSPECTOR</span></div>
        <div id="details-panel" style="padding: 20px;">
            <div style="color: var(--dim); text-align: center; margin-top: 60px; letter-spacing: 2px;">
                WAITING FOR TARGET SELECTION...
            </div>
        </div>
    </aside>

    <footer class="window bottom-log">
        <div class="win-header"><span>GLOBAL_LOG_STREAM</span></div>
        <div id="log-stream"></div>
    </footer>
</div>

<script>
    const RENDER_API = "https://prism-bot.onrender.com";
    
    const nodeData = {
        v1: { title: "ALPHA-M V1", loc: "KURAMPA_SEC_02", status: "DISCONNECTED", desc: "Объект потерян. Зафиксирована пространственная аномалия класса 'Омега'.", color: "#444" },
        v2: { title: "ALPHA-M V2", loc: "KURAMPA_SEC_03", status: "ABANDONED", desc: "Зона законсервирована после нарушения условий содержания #001.", color: "#444" },
        v22: { title: "ALPHA-M V2.2", loc: "KURAMPA_SEC_03", status: "ABANDONED", desc: "Системы жизнеобеспечения отключены вручную.", color: "#444" },
        v3: { title: "ALPHA-M V3", loc: "BLINK_BASE_MC", status: "ACTIVE", desc: "Действующий узел. Прямая связь с RENDER_CORE установлена.", color: "var(--neon)" }
    };

    function updateCoords(e) {
        const rect = document.getElementById('map-container').getBoundingClientRect();
        const x = Math.floor(e.clientX - rect.left);
        const y = Math.floor(e.clientY - rect.top);
        document.getElementById('coord-display').innerText = `X:${x.toString().padStart(3, '0')} Y:${y.toString().padStart(3, '0')}`;
    }

    function selectNode(id) {
        const data = nodeData[id];
        const panel = document.getElementById('details-panel');
        
        document.querySelectorAll('.point').forEach(p => p.classList.remove('selected'));
        if(event && event.target) event.target.classList.add('selected');

        panel.innerHTML = `
            <div style="border-bottom: 2px solid ${data.color}; padding-bottom: 10px; margin-bottom: 20px; font-weight: bold; font-size: 1.2em; color: #fff;">
                ${data.title}
            </div>
            <div style="margin-bottom: 10px;"><span style="color:var(--dim)">LOC:</span> ${data.loc}</div>
            <div style="margin-bottom: 10px;"><span style="color:var(--dim)">STS:</span> <span style="color:${data.color}">${data.status}</span></div>
            <div style="margin-bottom: 25px; font-size: 0.9em; line-height: 1.6; border: 1px solid var(--dim); padding: 12px; background: rgba(0,68,51,0.05);">
                > ${data.desc}
            </div>
            ${id === 'v3' ? '<button class="cmd-btn" onclick="openRemoteShell()">[ EXECUTE_REMOTE_SHELL ]</button>' : '<div style="color:var(--alert); font-size:0.8em; text-align:center;">// ERROR: NODE UNREACHABLE</div>'}
        `;
        addLogLine("INSPECT_REQ: " + data.title);
    }

    function addLogLine(text) {
        const stream = document.getElementById('log-stream');
        const line = document.createElement('div');
        line.className = 'log-line';
        line.innerHTML = `<span style="opacity:0.4">[${new Date().toLocaleTimeString()}]</span> > ${text}`;
        stream.prepend(line);
        if (stream.children.length > 12) stream.removeChild(stream.lastChild);
    }

    async function scanSectors() {
        addLogLine("INITIATING SECTOR SCAN...");
        try {
            const res = await fetch(`${RENDER_API}/get-staff`);
            const data = await res.json();
            addLogLine(`SCAN COMPLETE. DETECTED: ${Object.keys(data).length} UNITS.`);
        } catch (e) {
            addLogLine("SCAN_FAILED: CORE_NOT_RESPONDING");
        }
    }

    function openRemoteShell() {
        const shell = document.getElementById('shell-overlay');
        const output = document.getElementById('shell-output');
        shell.style.display = 'block';
        output.innerHTML = "";
        const seq = ["> SYNCING WITH ALPHA-M V3...", "> HANDSHAKE: SUCCESS", "> ENCRYPTION: AES-256", "> BYPASSING BIOMETRIC_SCAN...", "> ACCESS GRANTED.", "> PRISM_DAEMON_V4.5_READY..."];
        let i = 0;
        const int = setInterval(() => {
            output.innerHTML += seq[i++] + "\n";
            if (i >= seq.length) {
                clearInterval(int);
                output.innerHTML += "\n> _";
            }
        }, 300);
    }

    function closeShell() { document.getElementById('shell-overlay').style.display = 'none'; }

    // --- ACTIVITY GRAPH ---
    const canvas = document.getElementById('activity-graph');
    const gCtx = canvas.getContext('2d');
    let pts = Array(40).fill(35);

    function drawGraph() {
        canvas.width = 240; canvas.height = 70;
        gCtx.clearRect(0, 0, canvas.width, canvas.height);
        const isRed = document.documentElement.style.getPropertyValue('--neon') === '#ff4444';
        gCtx.strokeStyle = isRed ? '#ff4444' : '#00ffcc';
        gCtx.lineWidth = 2;
        gCtx.beginPath();
        gCtx.moveTo(0, pts[0]);
        for(let i=1; i<pts.length; i++) {
            gCtx.lineTo(i * (canvas.width/pts.length), pts[i]);
        }
        gCtx.stroke();
        pts.shift();
        pts.push(Math.random() * (isRed ? 60 : 30) + 5);
    }

    async function sync() {
        try {
            const res = await fetch(`${RENDER_API}/status`);
            const data = await res.json();
            const isRed = data.state === "RED";
            const v3 = document.getElementById('v3-node');
            
            document.documentElement.style.setProperty('--neon', isRed ? '#ff4444' : '#00ffcc');
            document.getElementById('net-status').innerText = isRed ? "ALERT" : "STABLE";
            v3.style.background = isRed ? "#ff4444" : "var(--neon)";
            v3.style.boxShadow = isRed ? "0 0 25px #ff4444" : "none";
            
            document.querySelectorAll('.node-link').forEach(l => {
                l.style.stroke = isRed ? "#ff4444" : "var(--dim)";
                l.style.strokeDasharray = isRed ? "2" : "4";
            });
            
            if(isRed) addLogLine("CRITICAL_SYSTEM_ALERT: STATE_RED");
        } catch (e) {
            document.getElementById('net-status').innerText = "OFFLINE";
        }
    }

    setInterval(() => {
        document.getElementById('sys-clock').innerText = new Date().toLocaleTimeString();
        const red = document.documentElement.style.getPropertyValue('--neon') === '#ff4444';
        document.getElementById('cpu-load').innerText = Math.floor(Math.random() * (red ? 50 : 15) + (red ? 40 : 5)) + "%";
        document.getElementById('entropy-val').innerText = (Math.random() * (red ? 1.0 : 0.0009)).toFixed(4);
        drawGraph();
    }, 1000);

    setInterval(sync, 5000);
    sync();
    addLogLine("INTEL_LINK_ESTABLISHED. MONITORING_ACTIVE.");
</script>
</body>
</html>