<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>P.R.I.S.M. | SECURE TERMINAL</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        :root {
            --neon-blue: #00ffcc; --neon-green: #00ff41; --neon-red: #ff3333;
            --neon-gold: #ffd700; --bg-dark: #050505; --border: #1a3a3a;
            --font-main: 'Courier New', monospace;
        }

        * { box-sizing: border-box; }
        body {
            background: var(--bg-dark); color: #ccc;
            font-family: var(--font-main); margin: 0;
            height: 100vh; overflow: hidden; text-transform: uppercase;
        }

        /* ЭФФЕКТЫ */
        .overlay { position: fixed; inset: 0; background: repeating-linear-gradient(0deg, rgba(0,0,0,0.1) 0px, transparent 2px); pointer-events: none; z-index: 9000; }
        .scanline { position: fixed; top: 0; left: 0; width: 100%; height: 4px; background: rgba(0, 255, 204, 0.03); z-index: 9001; pointer-events: none; animation: scan 8s linear infinite; }
        @keyframes scan { from { top: -10%; } to { top: 110%; } }

        /* ИНТЕРФЕЙС */
        #main-interface { display: none; height: 100vh; flex-direction: column; }
        header {
            height: 60px; border-bottom: 1px solid var(--border); background: #080808;
            display: flex; align-items: center; justify-content: space-between; padding: 0 25px;
            flex-shrink: 0;
        }

        .workspace { display: flex; flex: 1; overflow: hidden; }
        
        /* Боковая навигация */
        aside { width: 260px; border-right: 1px solid var(--border); background: #020202; flex-shrink: 0; }
        .nav-btn { padding: 18px 25px; color: #777; cursor: pointer; border-left: 2px solid transparent; transition: 0.3s; font-size: 0.9em; }
        .nav-btn.active { color: var(--neon-blue); border-left-color: var(--neon-blue); background: linear-gradient(90deg, rgba(0,255,204,0.08), transparent); }

        /* Основная область */
        main { flex: 1; position: relative; overflow: hidden; }
        .view-section { display: none; height: 100%; grid-template-columns: 320px 1fr; }
        .view-section.active { display: grid; }

        /* Колонки со скроллом */
        .list-column { height: 100%; overflow-y: auto; border-right: 1px solid var(--border); background: rgba(0,0,0,0.3); }
        .viewer-column { height: 100%; overflow-y: auto; padding: 40px; scroll-behavior: smooth; position: relative; }

        /* Элементы списка */
        .list-item { padding: 20px; border-bottom: 1px solid #111; cursor: pointer; display: flex; align-items: center; gap: 15px; transition: 0.2s; opacity: 0.7; }
        .list-item:hover, .list-item.active { opacity: 1; background: rgba(255,255,255,0.02); }
        .list-item.active { border-left: 3px solid var(--neon-blue); background: rgba(0, 255, 204, 0.05); }

        /* Досье и текст */
        .dossier-header { display: flex; gap: 30px; margin-bottom: 30px; border-bottom: 1px solid #222; padding-bottom: 30px; }
        .dossier-img { width: 160px; height: 160px; object-fit: cover; border: 1px solid #333; padding: 4px; background: #000; }
        .tag-box { display: inline-block; border: 1px solid; padding: 4px 8px; font-size: 0.7em; margin-top: 10px; }
        .text-content { font-size: 0.95em; color: #aaa; line-height: 1.6; white-space: pre-wrap; padding-bottom: 50px; }
        
        /* Служебные классы */
        .anomaly-marker { width: 10px; height: 10px; border-radius: 50%; }
        .m-safe { background: var(--neon-green); box-shadow: 0 0 5px var(--neon-green); }
        .m-critical { background: var(--neon-red); box-shadow: 0 0 5px var(--neon-red); animation: pulse 1s infinite; }
        .c-safe { color: var(--neon-green); border-color: var(--neon-green); }
        .c-critical { color: var(--neon-red); border-color: var(--neon-red); }
        .typing-cursor::after { content: '█'; animation: blink 0.8s infinite; color: var(--neon-blue); }

        @keyframes pulse { 50% { opacity: 0.3; } }
        @keyframes blink { 50% { opacity: 0; } }

        /* Скроллбар */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: #222; }
        ::-webkit-scrollbar-thumb:hover { background: var(--neon-blue); }
    </style>
</head>
<body>

<div class="overlay"></div><div class="scanline"></div>

<div id="access-screen">
    <div id="status-box">
        <div id="status-text" style="color: var(--neon-blue); letter-spacing: 5px;">СКАНИРОВАНИЕ БИОМЕТРИКИ...</div>
    </div>
</div>

<div id="main-interface">
    <header>
        <div class="header-title">P.R.I.S.M. <span style="color:var(--neon-blue); font-size:0.7em;">// DATABASE_V4</span></div>
        <div class="sys-status">
            <span>USER: <span id="u-name" class="val">---</span></span>
            <span>CLEARANCE: <span id="u-level" class="val">0</span></span>
            <span style="cursor: pointer; color: var(--neon-red);" onclick="logout()">[ВЫХОД]</span>
        </div>
    </header>

    <div class="workspace">
        <aside id="nav-aside">
            <div class="nav-btn active" onclick="switchModule('anomalies', this)">> РЕЕСТР АНОМАЛИЙ</div>
            <div class="nav-btn" onclick="switchModule('staff', this)">> ЛИЧНЫЕ ДЕЛА</div>
            <div class="nav-btn" onclick="switchModule('archive', this)">> АРХИВ</div>
        </aside>

        <main>
            <div id="mod-anomalies" class="view-section active">
                <div class="list-column" id="anomaly-list"></div>
                <div class="viewer-column" id="ano-viewer-cont">
                    <div id="ano-placeholder" class="empty-state">ВЫБЕРИТЕ ОБЪЕКТ</div>
                    <div id="ano-content" style="display:none;">
                        <div class="dossier-header">
                            <img id="a-img" class="dossier-img">
                            <div>
                                <h1 id="a-code" class="dossier-title"></h1>
                                <div id="a-name" class="dossier-subtitle"></div>
                                <div id="a-class" class="tag-box"></div>
                            </div>
                        </div>
                        <div id="a-desc" class="text-content"></div>
                    </div>
                </div>
            </div>

            <div id="mod-staff" class="view-section">
                <div class="list-column" id="staff-list"></div>
                <div class="viewer-column" id="staff-viewer-cont">
                    <div id="staff-content" style="display:none;">
                        <div class="dossier-header">
                            <img id="s-img" class="dossier-img">
                            <div>
                                <h1 id="s-name" class="dossier-title"></h1>
                                <div id="s-id" class="dossier-subtitle"></div>
                                <div id="s-level" class="tag-box"></div>
                            </div>
                        </div>
                        <div id="s-bio" class="text-content"></div>
                    </div>
                </div>
            </div>

            <div id="mod-archive" class="view-section">
                <div class="list-column" id="archive-list"></div>
                <div class="viewer-column" id="archive-viewer-cont">
                    <div id="archive-content" style="display:none;">
                        <h1 id="r-title" class="dossier-title"></h1>
                        <div id="r-meta" class="dossier-subtitle"></div>
                        <div id="r-text" class="text-content"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>

<script>
    const RENDER_API = "https://prism-bot.onrender.com";
    const GITHUB_JSON = "https://raw.githubusercontent.com/SumberPlay/prismminecraft/main/data/archive.json";
    
    let USER = { name: "", level: 0 };
    let typeTimer = null;

    const ANOMALIES = [
        { id: "001", code: "КОНЕЦ", lvl: 4, class: "critical", desc: "Точка сингулярности, вызывающая распад атомных связей в радиусе воздействия." },
        { id: "002", code: "РАЗЛОМ", lvl: 0, class: "safe", desc: "Стабильный пространственный разрыв. Ведет в карманное измерение." },
        { id: "003", code: "МАРТИ", lvl: 5, class: "critical", desc: "Гуманоидная сущность, способная менять локальную физику." },
        { id: "004", code: "ЭХО", lvl: 2, class: "moderate", desc: "Акустический феномен. Повторяет мысли субъекта." }
    ];

    window.onload = function() {
        const storedName = localStorage.getItem('prism_name');
        const storedLevel = localStorage.getItem('prism_level');
        if (storedName) {
            USER.name = storedName;
            USER.level = parseInt(storedLevel);
            initInterface();
        } else {
            document.getElementById('status-box').innerHTML = `<h2 style="color:var(--neon-red)">ACCESS DENIED</h2><a href="staff.html" style="color:var(--neon-blue)">ВЕРНУТЬСЯ</a>`;
        }
    };

    function initInterface() {
        document.getElementById('access-screen').style.display = 'none';
        document.getElementById('main-interface').style.display = 'flex';
        document.getElementById('u-name').innerText = USER.name;
        document.getElementById('u-level').innerText = "LEVEL " + USER.level;
        renderAnomalyList();
        loadStaff();
        loadArchive();
    }

    function switchModule(modId, btn) {
        document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
        document.getElementById(`mod-${modId}`).classList.add('active');
        btn.classList.add('active');
    }

    function renderAnomalyList() {
        const list = document.getElementById('anomaly-list');
        list.innerHTML = "";
        ANOMALIES.forEach(a => {
            const isLocked = USER.level < a.lvl;
            const item = document.createElement('div');
            item.className = `list-item ${isLocked ? 'locked' : ''}`;
            item.innerHTML = `<div class="anomaly-marker m-${isLocked ? 'critical' : a.class}"></div>
                              <div><div>#${a.id} ${isLocked ? 'CLASSIFIED' : a.code}</div></div>`;
            item.onclick = () => {
                if(isLocked) return alert("ДОСТУП ЗАПРЕЩЕН");
                openAnomaly(a, item);
            };
            list.appendChild(item);
        });
    }

    function openAnomaly(data, el) {
        document.querySelectorAll('#anomaly-list .list-item').forEach(i => i.classList.remove('active'));
        el.classList.add('active');
        document.getElementById('ano-placeholder').style.display = 'none';
        document.getElementById('ano-content').style.display = 'block';
        document.getElementById('a-img').src = `https://via.placeholder.com/160/000000/00ffcc?text=OBJ-${data.id}`;
        document.getElementById('a-code').innerText = data.code;
        const badge = document.getElementById('a-class');
        badge.innerText = data.class.toUpperCase();
        badge.className = `tag-box c-${data.class}`;
        typeText(document.getElementById('a-desc'), data.desc, document.getElementById('ano-viewer-cont'));
    }

    async function loadStaff() {
        try {
            const res = await fetch(`${RENDER_API}/get-staff`);
            const db = await res.json();
            const list = document.getElementById('staff-list');
            Object.entries(db).forEach(([id, p]) => {
                const isHidden = USER.level < p.level;
                const item = document.createElement('div');
                item.className = "list-item";
                item.innerHTML = `<img src="https://minotar.net/helm/${isHidden ? 'Steve' : p.mc_name}/32.png" style="width:24px;">
                                  <div>${isHidden ? 'ЗАСЕКРЕЧЕНО' : (p.name || id)}</div>`;
                item.onclick = () => {
                    document.getElementById('staff-content').style.display = 'block';
                    document.getElementById('s-img').src = `https://minotar.net/armor/bust/${isHidden ? 'Steve' : p.mc_name}/160.png`;
                    document.getElementById('s-name').innerText = isHidden ? "???" : p.name;
                    typeText(document.getElementById('s-bio'), isHidden ? "ДОСТУП ОГРАНИЧЕН" : p.bio, document.getElementById('staff-viewer-cont'));
                };
                list.appendChild(item);
            });
        } catch(e) {}
    }

    async function loadArchive() {
        try {
            const res = await fetch(`${GITHUB_JSON}?t=${Date.now()}`);
            const files = await res.json();
            const list = document.getElementById('archive-list');
            list.innerHTML = "";
            files.reverse().forEach(f => {
                const item = document.createElement('div');
                item.className = "list-item";
                item.innerHTML = `<div>${f.title}</div>`;
                item.onclick = () => {
                    document.getElementById('archive-content').style.display = 'block';
                    document.getElementById('r-title').innerText = f.title;
                    typeText(document.getElementById('r-text'), f.content, document.getElementById('archive-viewer-cont'));
                };
                list.appendChild(item);
            });
        } catch(e) {}
    }

    function typeText(el, text, container) {
        if(typeTimer) clearInterval(typeTimer);
        el.innerText = "";
        el.classList.add('typing-cursor');
        if(container) container.scrollTop = 0; // СБРОС СКРОЛЛА В НАЧАЛО
        let i = 0;
        typeTimer = setInterval(() => {
            el.innerText = text.substring(0, i);
            i++;
            if(i > text.length) {
                clearInterval(typeTimer);
                el.classList.remove('typing-cursor');
            }
        }, 5);
    }

    function logout() { localStorage.clear(); location.href = "staff.html"; }
</script>
</body>
</html>
