<!DOCTYPE html>
<html lang="ru">
<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <meta charset="UTF-8">
    <title>P.R.I.S.M. | АРХИВ_АНОМАЛИЙ</title>
    <style>
        :root { 
            --term-green: #00ff41; 
            --term-dim: #003b00;
            --alert-red: #ff0000; 
            --bg-dark: #050505; 
        }

        body { 
            background: var(--bg-dark); 
            color: var(--term-green); 
            font-family: 'Courier New', monospace; 
            margin: 0; 
            text-transform: uppercase;
        }

        /* Эффект ЭЛТ-монитора */
        body::before {
            content: " ";
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%), 
                        linear-gradient(90deg, rgba(255, 0, 0, 0.03), rgba(0, 255, 0, 0.01), rgba(0, 0, 255, 0.03));
            background-size: 100% 3px, 3px 100%;
            pointer-events: none; z-index: 1000;
        }

        nav { border-bottom: 1px solid var(--term-green); padding: 15px; background: #000; }
        nav a { color: var(--term-green); text-decoration: none; margin-right: 25px; font-size: 0.8em; opacity: 0.7; }
        nav a:hover { opacity: 1; text-shadow: 0 0 8px var(--term-green); }

        .container { max-width: 900px; margin: 40px auto; padding: 25px; border: 1px solid var(--term-dim); position: relative; }
        
        h2 { border-bottom: 1px solid var(--term-green); padding-bottom: 10px; letter-spacing: 2px; }

        .object-entry {
            display: flex;
            gap: 20px;
            margin-bottom: 40px;
            padding: 20px;
            border: 1px solid var(--term-dim);
            background: rgba(0, 20, 0, 0.1);
        }

        .object-image {
            width: 200px;
            height: 150px;
            border: 1px solid var(--term-green);
            filter: grayscale(1) sepia(1) hue-rotate(90deg) brightness(0.8);
            object-fit: cover;
        }

        .object-data { flex: 1; }
        .object-id { color: var(--term-green); font-size: 1.2em; font-weight: bold; margin-bottom: 5px; }

        .threat-level {
            display: inline-block;
            padding: 2px 10px;
            font-size: 0.7em;
            font-weight: bold;
            color: #000;
            margin-bottom: 15px;
        }

        .green { background: var(--term-green); }
        .yellow { background: #ffd700; }
        .red { background: var(--alert-red); animation: pulse 1s infinite; }

        @keyframes pulse { 50% { opacity: 0.5; } }

        .object-desc { font-size: 0.9em; line-height: 1.4; color: #aaa; min-height: 50px; }

        .cursor { display: inline-block; width: 8px; height: 1.2em; background: var(--term-green); animation: blink 0.8s infinite; vertical-align: middle; }
        @keyframes blink { 50% { opacity: 0; } }

        .back-btn {
            display: block;
            margin-top: 30px;
            color: var(--term-dim);
            text-decoration: none;
            text-align: center;
            font-size: 0.8em;
        }
        .back-btn:hover { color: var(--term-green); }

        .glitch-char { color: var(--alert-red); text-shadow: 1px 1px var(--term-green); }
    </style>
</head>
<body>

<nav>
    <a href="index.html"><< НА ГЛАВНУЮ</a>
    <a href="staff.html"><< ТЕРМИНАЛ</a>
</nav>

<div class="container">
    <h2>БАЗА_ДАННЫХ_АНОМАЛИЙ</h2>
    <p style="color: var(--term-dim); font-size: 0.8em;">
        СТАТУС_СИСТЕМЫ: <span id="sync-val">ПРОВЕРКА...</span> | 
        ДОСТУП: УРОВЕНЬ_<span id="access-display">?</span>
    </p>

    <div id="archive-container">
        <div class="object-entry" data-level="3">
            <img src="https://via.placeholder.com/200x150?text=DATA_LOST" class="object-image">
            <div class="object-data">
                <div class="object-id">#001 "КОНЕЦ"</div>
                <div class="threat-level yellow">УРОВЕНЬ: УМЕРЕННЫЙ</div>
                <div class="object-desc" data-text="Класс работы - Омега. Явление, при котором со временем каждый мир подлежит забвению. Имеет разные уровни воздействия - от исчезновения части существ до полного уничтожения."></div>
            </div>
        </div>

        <div class="object-entry" data-level="0">
            <img src="https://via.placeholder.com/200x150?text=DATA_LOST" class="object-image">
            <div class="object-data">
                <div class="object-id">#002 "РАЗЛОМ"</div>
                <div class="threat-level green">УРОВЕНЬ: БЕЗОПАСНЫЙ</div>
                <div class="object-desc" data-text="Класс работы - Бета. Разлом - пространственная брешь, позволяющая перемещаться между разными мирами. Выделяют энергию. Рекомендуется дальнейшее изучение явления."></div>
            </div>
        </div>

        <div class="object-entry" data-level="5">
            <img src="https://via.placeholder.com/200x150?text=DATA_LOST" class="object-image">
            <div class="object-data">
                <div class="object-id">#003 "МАРТИ"</div>
                <div class="threat-level red">УРОВЕНЬ: КРИТИЧЕСКИЙ</div>
                <div class="object-desc" data-text="ВНИМАНИЕ: Описание доступно только Высшему Совету. Объект 003 — существо, не подчиняющееся никаким законам пространства-времени. Способен вызывать локальные искажения реальности."></div>
            </div>
        </div>
    </div>

    <a href="staff.html" class="back-btn">>> ВЕРНУТЬСЯ_В_ТЕРМИНАЛ</a>
</div>

<script>
const RENDER_API = "https://prism-bot.onrender.com";

// База для подстраховки (если уровень не передался через сессию)
const backupDB = {
    "M4SK": 3,
    "KRMP": 2,
    "SUMBR": 5,
    "MRYZE": 5
};

async function syncSystem() {
    try {
        const res = await fetch(`${RENDER_API}/status`);
        const data = await res.json();
        const sv = document.getElementById('sync-val');
        sv.innerText = data.label;
        sv.style.color = data.color;
    } catch (e) { document.getElementById('sync-val').innerText = "OFFLINE"; }
}

document.addEventListener("DOMContentLoaded", () => {
    // 1. Пытаемся достать уровень напрямую
    let userLevel = sessionStorage.getItem('prism_level');
    
    // 2. Если уровня нет, пробуем узнать его по ID пользователя
    if (userLevel === null) {
        const uid = sessionStorage.getItem('prism_uid');
        userLevel = backupDB[uid] || 0;
        // Сохраняем на будущее, чтобы больше не терялся
        sessionStorage.setItem('prism_level', userLevel);
    }

    userLevel = parseInt(userLevel);
    document.getElementById('access-display').innerText = userLevel;
    
    const entries = document.querySelectorAll('.object-entry');

    entries.forEach((entry, index) => {
        const reqLevel = parseInt(entry.getAttribute('data-level'));
        const descElement = entry.querySelector('.object-desc');
        const originalText = descElement.getAttribute('data-text');

        // Логика доступа
        if (reqLevel > userLevel) {
            if (reqLevel >= 5) {
                entry.style.display = "none";
            } else {
                descElement.innerHTML = `<span style="color:var(--alert-red);">[ДАННЫЕ ЗАСЕКРЕЧЕНЫ: ТРЕБУЕТСЯ УРОВЕНЬ ${reqLevel}]</span>`;
            }
            return;
        }

        // Эффект печати
        descElement.innerHTML = '<span class="text-holder"></span><span class="cursor"></span>';
        const holder = descElement.querySelector('.text-holder');
        
        setTimeout(() => {
            let i = 0;
            const timer = setInterval(() => {
                if (i < originalText.length) {
                    holder.innerText += originalText.charAt(i);
                    i++;
                } else {
                    clearInterval(timer);
                    const cursor = descElement.querySelector('.cursor');
                    if (cursor) cursor.remove();
                    if (reqLevel >= 3) startGlitches(holder);
                }
            }, 25);
        }, index * 300);
    });
});

function startGlitches(el) {
    const txt = el.innerText;
    const syms = "█▓▒░$#@&*";
    setInterval(() => {
        if (Math.random() > 0.95) {
            let arr = txt.split("");
            let p = Math.floor(Math.random() * arr.length);
            arr[p] = `<span class="glitch-char">${syms[Math.floor(Math.random()*syms.length)]}</span>`;
            el.innerHTML = arr.join("");
            setTimeout(() => el.innerHTML = txt, 100);
        }
    }, 150);
}

setInterval(syncSystem, 5000);
syncSystem();
</script>
</body>
</html>

